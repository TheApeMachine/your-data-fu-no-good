var vr=Object.defineProperty;var Dt=e=>{throw TypeError(e)};var xr=(e,t,r)=>t in e?vr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var _=(e,t,r)=>xr(e,typeof t!="symbol"?t+"":t,r),St=(e,t,r)=>t.has(e)||Dt("Cannot "+r);var h=(e,t,r)=>(St(e,t,"read from private field"),r?r.call(e):t.get(e)),O=(e,t,r)=>t.has(e)?Dt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),w=(e,t,r,n)=>(St(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),F=(e,t,r)=>(St(e,t,"access private method"),r);var It=(e,t,r,n)=>({set _(i){w(e,t,i,r)},get _(){return h(e,t,n)}});var $t=(e,t,r)=>(n,i)=>{let s=-1;return a(0);async function a(o){if(o<=s)throw new Error("next() called multiple times");s=o;let c,l=!1,f;if(e[o]?(f=e[o][0][0],n.req.routeIndex=o):f=o===e.length&&i||void 0,f)try{c=await f(n,()=>a(o+1))}catch(p){if(p instanceof Error&&t)n.error=p,c=await t(p,n),l=!0;else throw p}else n.finalized===!1&&r&&(c=await r(n));return c&&(n.finalized===!1||l)&&(n.res=c),n}},wr=Symbol(),_r=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,s=(e instanceof rr?e.raw.headers:e.headers).get("Content-Type");return s!=null&&s.startsWith("multipart/form-data")||s!=null&&s.startsWith("application/x-www-form-urlencoded")?Er(e,{all:r,dot:n}):{}};async function Er(e,t){const r=await e.formData();return r?Rr(r,t):{}}function Rr(e,t){const r=Object.create(null);return e.forEach((n,i)=>{t.all||i.endsWith("[]")?Sr(r,i,n):r[i]=n}),t.dot&&Object.entries(r).forEach(([n,i])=>{n.includes(".")&&(Cr(r,n,i),delete r[n])}),r}var Sr=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Cr=(e,t,r)=>{let n=e;const i=t.split(".");i.forEach((s,a)=>{a===i.length-1?n[s]=r:((!n[s]||typeof n[s]!="object"||Array.isArray(n[s])||n[s]instanceof File)&&(n[s]=Object.create(null)),n=n[s])})},Qt=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Or=e=>{const{groups:t,path:r}=Tr(e),n=Qt(r);return kr(n,t)},Tr=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const i=`@${n}`;return t.push([i,r]),i}),{groups:t,path:e}},kr=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let i=e.length-1;i>=0;i--)if(e[i].includes(n)){e[i]=e[i].replace(n,t[r][1]);break}}return e},mt={},Ar=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return mt[n]||(r[2]?mt[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:mt[n]=[e,r[1],!0]),mt[n]}return null},At=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},jr=e=>At(e,decodeURI),Xt=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const i=t.charCodeAt(n);if(i===37){const s=t.indexOf("?",n),a=t.slice(r,s===-1?void 0:s);return jr(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(i===63)break}return t.slice(r,n)},Nr=e=>{const t=Xt(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},Je=(e,t,...r)=>(r.length&&(t=Je(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Zt=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))n+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&n===""?r.push("/"):r.push(n);const s=i.replace("?","");n+="/"+s,r.push(n)}else n+="/"+i}),r.filter((i,s,a)=>a.indexOf(i)===s)},Ct=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?At(e,tr):e):e,er=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const o=e.charCodeAt(a+t.length+1);if(o===61){const c=a+t.length+2,l=e.indexOf("&",c);return Ct(e.slice(c,l===-1?void 0:l))}else if(o==38||isNaN(o))return"";a=e.indexOf(`&${t}`,a+1)}if(n=/[%+]/.test(e),!n)return}const i={};n??(n=/[%+]/.test(e));let s=e.indexOf("?",8);for(;s!==-1;){const a=e.indexOf("&",s+1);let o=e.indexOf("=",s);o>a&&a!==-1&&(o=-1);let c=e.slice(s+1,o===-1?a===-1?void 0:a:o);if(n&&(c=Ct(c)),s=a,c==="")continue;let l;o===-1?l="":(l=e.slice(o+1,a===-1?void 0:a),n&&(l=Ct(l))),r?(i[c]&&Array.isArray(i[c])||(i[c]=[]),i[c].push(l)):i[c]??(i[c]=l)}return t?i[t]:i},Dr=er,Ir=(e,t)=>er(e,t,!0),tr=decodeURIComponent,Mt=e=>At(e,tr),Ye,ue,Re,nr,sr,Tt,ke,zt,rr=(zt=class{constructor(e,t="/",r=[[]]){O(this,Re);_(this,"raw");O(this,Ye);O(this,ue);_(this,"routeIndex",0);_(this,"path");_(this,"bodyCache",{});O(this,ke,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const i=Object.keys(t)[0];return i?t[i].then(s=>(i==="json"&&(s=JSON.stringify(s)),new Response(s)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,w(this,ue,r),w(this,Ye,{})}param(e){return e?F(this,Re,nr).call(this,e):F(this,Re,sr).call(this)}query(e){return Dr(this.url,e)}queries(e){return Ir(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await _r(this,e))}json(){return h(this,ke).call(this,"text").then(e=>JSON.parse(e))}text(){return h(this,ke).call(this,"text")}arrayBuffer(){return h(this,ke).call(this,"arrayBuffer")}blob(){return h(this,ke).call(this,"blob")}formData(){return h(this,ke).call(this,"formData")}addValidatedData(e,t){h(this,Ye)[e]=t}valid(e){return h(this,Ye)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[wr](){return h(this,ue)}get matchedRoutes(){return h(this,ue)[0].map(([[,e]])=>e)}get routePath(){return h(this,ue)[0].map(([[,e]])=>e)[this.routeIndex].path}},Ye=new WeakMap,ue=new WeakMap,Re=new WeakSet,nr=function(e){const t=h(this,ue)[0][this.routeIndex][1][e],r=F(this,Re,Tt).call(this,t);return r&&/\%/.test(r)?Mt(r):r},sr=function(){const e={},t=Object.keys(h(this,ue)[0][this.routeIndex][1]);for(const r of t){const n=F(this,Re,Tt).call(this,h(this,ue)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?Mt(n):n)}return e},Tt=function(e){return h(this,ue)[1]?h(this,ue)[1][e]:e},ke=new WeakMap,zt),$r={Stringify:1},ir=async(e,t,r,n,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const s=e.callbacks;return s!=null&&s.length?(i?i[0]+=e:i=[e],Promise.all(s.map(o=>o({phase:t,buffer:i,context:n}))).then(o=>Promise.all(o.filter(Boolean).map(c=>ir(c,t,!1,n,i))).then(()=>i[0]))):Promise.resolve(e)},Mr="text/plain; charset=UTF-8",Ot=(e,t)=>({"Content-Type":e,...t}),ut,dt,xe,Qe,we,se,ht,Xe,Ze,qe,ft,pt,Ae,Ke,Ut,Pr=(Ut=class{constructor(e,t){O(this,Ae);O(this,ut);O(this,dt);_(this,"env",{});O(this,xe);_(this,"finalized",!1);_(this,"error");O(this,Qe);O(this,we);O(this,se);O(this,ht);O(this,Xe);O(this,Ze);O(this,qe);O(this,ft);O(this,pt);_(this,"render",(...e)=>(h(this,Xe)??w(this,Xe,t=>this.html(t)),h(this,Xe).call(this,...e)));_(this,"setLayout",e=>w(this,ht,e));_(this,"getLayout",()=>h(this,ht));_(this,"setRenderer",e=>{w(this,Xe,e)});_(this,"header",(e,t,r)=>{this.finalized&&w(this,se,new Response(h(this,se).body,h(this,se)));const n=h(this,se)?h(this,se).headers:h(this,qe)??w(this,qe,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});_(this,"status",e=>{w(this,Qe,e)});_(this,"set",(e,t)=>{h(this,xe)??w(this,xe,new Map),h(this,xe).set(e,t)});_(this,"get",e=>h(this,xe)?h(this,xe).get(e):void 0);_(this,"newResponse",(...e)=>F(this,Ae,Ke).call(this,...e));_(this,"body",(e,t,r)=>F(this,Ae,Ke).call(this,e,t,r));_(this,"text",(e,t,r)=>!h(this,qe)&&!h(this,Qe)&&!t&&!r&&!this.finalized?new Response(e):F(this,Ae,Ke).call(this,e,t,Ot(Mr,r)));_(this,"json",(e,t,r)=>F(this,Ae,Ke).call(this,JSON.stringify(e),t,Ot("application/json",r)));_(this,"html",(e,t,r)=>{const n=i=>F(this,Ae,Ke).call(this,i,t,Ot("text/html; charset=UTF-8",r));return typeof e=="object"?ir(e,$r.Stringify,!1,{}).then(n):n(e)});_(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});_(this,"notFound",()=>(h(this,Ze)??w(this,Ze,()=>new Response),h(this,Ze).call(this,this)));w(this,ut,e),t&&(w(this,we,t.executionCtx),this.env=t.env,w(this,Ze,t.notFoundHandler),w(this,pt,t.path),w(this,ft,t.matchResult))}get req(){return h(this,dt)??w(this,dt,new rr(h(this,ut),h(this,pt),h(this,ft))),h(this,dt)}get event(){if(h(this,we)&&"respondWith"in h(this,we))return h(this,we);throw Error("This context has no FetchEvent")}get executionCtx(){if(h(this,we))return h(this,we);throw Error("This context has no ExecutionContext")}get res(){return h(this,se)||w(this,se,new Response(null,{headers:h(this,qe)??w(this,qe,new Headers)}))}set res(e){if(h(this,se)&&e){e=new Response(e.body,e);for(const[t,r]of h(this,se).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=h(this,se).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of n)e.headers.append("set-cookie",i)}else e.headers.set(t,r)}w(this,se,e),this.finalized=!0}get var(){return h(this,xe)?Object.fromEntries(h(this,xe)):{}}},ut=new WeakMap,dt=new WeakMap,xe=new WeakMap,Qe=new WeakMap,we=new WeakMap,se=new WeakMap,ht=new WeakMap,Xe=new WeakMap,Ze=new WeakMap,qe=new WeakMap,ft=new WeakMap,pt=new WeakMap,Ae=new WeakSet,Ke=function(e,t,r){const n=h(this,se)?new Headers(h(this,se).headers):h(this,qe)??new Headers;if(typeof t=="object"&&"headers"in t){const s=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,o]of s)a.toLowerCase()==="set-cookie"?n.append(a,o):n.set(a,o)}if(r)for(const[s,a]of Object.entries(r))if(typeof a=="string")n.set(s,a);else{n.delete(s);for(const o of a)n.append(s,o)}const i=typeof t=="number"?t:(t==null?void 0:t.status)??h(this,Qe);return new Response(e,{status:i,headers:n})},Ut),Y="ALL",Fr="all",qr=["get","post","put","delete","options","patch"],ar="Can not add a route since the matcher is already built.",or=class extends Error{},Lr="__COMPOSED_HANDLER",Hr=e=>e.text("404 Not Found",404),Pt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},fe,Q,cr,pe,Pe,yt,bt,Bt,lr=(Bt=class{constructor(t={}){O(this,Q);_(this,"get");_(this,"post");_(this,"put");_(this,"delete");_(this,"options");_(this,"patch");_(this,"all");_(this,"on");_(this,"use");_(this,"router");_(this,"getPath");_(this,"_basePath","/");O(this,fe,"/");_(this,"routes",[]);O(this,pe,Hr);_(this,"errorHandler",Pt);_(this,"onError",t=>(this.errorHandler=t,this));_(this,"notFound",t=>(w(this,pe,t),this));_(this,"fetch",(t,...r)=>F(this,Q,bt).call(this,t,r[1],r[0],t.method));_(this,"request",(t,r,n,i)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,i):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${Je("/",t)}`,r),n,i)));_(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(F(this,Q,bt).call(this,t.request,t,void 0,t.request.method))})});[...qr,Fr].forEach(s=>{this[s]=(a,...o)=>(typeof a=="string"?w(this,fe,a):F(this,Q,Pe).call(this,s,h(this,fe),a),o.forEach(c=>{F(this,Q,Pe).call(this,s,h(this,fe),c)}),this)}),this.on=(s,a,...o)=>{for(const c of[a].flat()){w(this,fe,c);for(const l of[s].flat())o.map(f=>{F(this,Q,Pe).call(this,l.toUpperCase(),h(this,fe),f)})}return this},this.use=(s,...a)=>(typeof s=="string"?w(this,fe,s):(w(this,fe,"*"),a.unshift(s)),a.forEach(o=>{F(this,Q,Pe).call(this,Y,h(this,fe),o)}),this);const{strict:n,...i}=t;Object.assign(this,i),this.getPath=n??!0?t.getPath??Xt:Nr}route(t,r){const n=this.basePath(t);return r.routes.map(i=>{var a;let s;r.errorHandler===Pt?s=i.handler:(s=async(o,c)=>(await $t([],r.errorHandler)(o,()=>i.handler(o,c))).res,s[Lr]=i.handler),F(a=n,Q,Pe).call(a,i.method,i.path,s)}),this}basePath(t){const r=F(this,Q,cr).call(this);return r._basePath=Je(this._basePath,t),r}mount(t,r,n){let i,s;n&&(typeof n=="function"?s=n:(s=n.optionHandler,n.replaceRequest===!1?i=c=>c:i=n.replaceRequest));const a=s?c=>{const l=s(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};i||(i=(()=>{const c=Je(this._basePath,t),l=c==="/"?0:c.length;return f=>{const p=new URL(f.url);return p.pathname=p.pathname.slice(l)||"/",new Request(p,f)}})());const o=async(c,l)=>{const f=await r(i(c.req.raw),...a(c));if(f)return f;await l()};return F(this,Q,Pe).call(this,Y,Je(t,"*"),o),this}},fe=new WeakMap,Q=new WeakSet,cr=function(){const t=new lr({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,w(t,pe,h(this,pe)),t.routes=this.routes,t},pe=new WeakMap,Pe=function(t,r,n){t=t.toUpperCase(),r=Je(this._basePath,r);const i={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,i]),this.routes.push(i)},yt=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},bt=function(t,r,n,i){if(i==="HEAD")return(async()=>new Response(null,await F(this,Q,bt).call(this,t,r,n,"GET")))();const s=this.getPath(t,{env:n}),a=this.router.match(i,s),o=new Pr(t,{path:s,matchResult:a,env:n,executionCtx:r,notFoundHandler:h(this,pe)});if(a[0].length===1){let l;try{l=a[0][0][0][0](o,async()=>{o.res=await h(this,pe).call(this,o)})}catch(f){return F(this,Q,yt).call(this,f,o)}return l instanceof Promise?l.then(f=>f||(o.finalized?o.res:h(this,pe).call(this,o))).catch(f=>F(this,Q,yt).call(this,f,o)):l??h(this,pe).call(this,o)}const c=$t(a[0],this.errorHandler,h(this,pe));return(async()=>{try{const l=await c(o);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return F(this,Q,yt).call(this,l,o)}})()},Bt),ur=[];function zr(e,t){const r=this.buildAllMatchers(),n=(i,s)=>{const a=r[i]||r[Y],o=a[2][s];if(o)return o;const c=s.match(a[0]);if(!c)return[[],ur];const l=c.indexOf("",1);return[a[1][l],c]};return this.match=n,n(e,t)}var wt="[^/]+",ot=".*",lt="(?:|/.*)",Ge=Symbol(),Ur=new Set(".\\+*[^]$()");function Br(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ot||e===lt?1:t===ot||t===lt?-1:e===wt?1:t===wt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Le,He,ge,Wt,kt=(Wt=class{constructor(){O(this,Le);O(this,He);O(this,ge,Object.create(null))}insert(t,r,n,i,s){if(t.length===0){if(h(this,Le)!==void 0)throw Ge;if(s)return;w(this,Le,r);return}const[a,...o]=t,c=a==="*"?o.length===0?["","",ot]:["","",wt]:a==="/*"?["","",lt]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const f=c[1];let p=c[2]||wt;if(f&&c[2]&&(p===".*"||(p=p.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(p))))throw Ge;if(l=h(this,ge)[p],!l){if(Object.keys(h(this,ge)).some(m=>m!==ot&&m!==lt))throw Ge;if(s)return;l=h(this,ge)[p]=new kt,f!==""&&w(l,He,i.varIndex++)}!s&&f!==""&&n.push([f,h(l,He)])}else if(l=h(this,ge)[a],!l){if(Object.keys(h(this,ge)).some(f=>f.length>1&&f!==ot&&f!==lt))throw Ge;if(s)return;l=h(this,ge)[a]=new kt}l.insert(o,r,n,i,s)}buildRegExpStr(){const r=Object.keys(h(this,ge)).sort(Br).map(n=>{const i=h(this,ge)[n];return(typeof h(i,He)=="number"?`(${n})@${h(i,He)}`:Ur.has(n)?`\\${n}`:n)+i.buildRegExpStr()});return typeof h(this,Le)=="number"&&r.unshift(`#${h(this,Le)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Le=new WeakMap,He=new WeakMap,ge=new WeakMap,Wt),_t,gt,Vt,Wr=(Vt=class{constructor(){O(this,_t,{varIndex:0});O(this,gt,new kt)}insert(e,t,r){const n=[],i=[];for(let a=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const l=`@\\${a}`;return i[a]=[l,c],a++,o=!0,l}),!o)break}const s=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=i.length-1;a>=0;a--){const[o]=i[a];for(let c=s.length-1;c>=0;c--)if(s[c].indexOf(o)!==-1){s[c]=s[c].replace(o,i[a][1]);break}}return h(this,gt).insert(s,t,n,h(this,_t),r),n}buildRegExp(){let e=h(this,gt).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,s,a)=>s!==void 0?(r[++t]=Number(s),"$()"):(a!==void 0&&(n[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,n]}},_t=new WeakMap,gt=new WeakMap,Vt),Vr=[/^$/,[],Object.create(null)],vt=Object.create(null);function dr(e){return vt[e]??(vt[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Jr(){vt=Object.create(null)}function Kr(e){var l;const t=new Wr,r=[];if(e.length===0)return Vr;const n=e.map(f=>[!/\*|\/:/.test(f[0]),...f]).sort(([f,p],[m,v])=>f?1:m?-1:p.length-v.length),i=Object.create(null);for(let f=0,p=-1,m=n.length;f<m;f++){const[v,I,A]=n[f];v?i[I]=[A.map(([H])=>[H,Object.create(null)]),ur]:p++;let $;try{$=t.insert(I,p,v)}catch(H){throw H===Ge?new or(I):H}v||(r[p]=A.map(([H,Ce])=>{const Oe=Object.create(null);for(Ce-=1;Ce>=0;Ce--){const[ae,Me]=$[Ce];Oe[ae]=Me}return[H,Oe]}))}const[s,a,o]=t.buildRegExp();for(let f=0,p=r.length;f<p;f++)for(let m=0,v=r[f].length;m<v;m++){const I=(l=r[f][m])==null?void 0:l[1];if(!I)continue;const A=Object.keys(I);for(let $=0,H=A.length;$<H;$++)I[A[$]]=o[I[A[$]]]}const c=[];for(const f in a)c[f]=r[a[f]];return[s,c,i]}function Ve(e,t){if(e){for(const r of Object.keys(e).sort((n,i)=>i.length-n.length))if(dr(r).test(t))return[...e[r]]}}var je,Ne,Et,hr,Jt,Gr=(Jt=class{constructor(){O(this,Et);_(this,"name","RegExpRouter");O(this,je);O(this,Ne);_(this,"match",zr);w(this,je,{[Y]:Object.create(null)}),w(this,Ne,{[Y]:Object.create(null)})}add(e,t,r){var o;const n=h(this,je),i=h(this,Ne);if(!n||!i)throw new Error(ar);n[e]||[n,i].forEach(c=>{c[e]=Object.create(null),Object.keys(c[Y]).forEach(l=>{c[e][l]=[...c[Y][l]]})}),t==="/*"&&(t="*");const s=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=dr(t);e===Y?Object.keys(n).forEach(l=>{var f;(f=n[l])[t]||(f[t]=Ve(n[l],t)||Ve(n[Y],t)||[])}):(o=n[e])[t]||(o[t]=Ve(n[e],t)||Ve(n[Y],t)||[]),Object.keys(n).forEach(l=>{(e===Y||e===l)&&Object.keys(n[l]).forEach(f=>{c.test(f)&&n[l][f].push([r,s])})}),Object.keys(i).forEach(l=>{(e===Y||e===l)&&Object.keys(i[l]).forEach(f=>c.test(f)&&i[l][f].push([r,s]))});return}const a=Zt(t)||[t];for(let c=0,l=a.length;c<l;c++){const f=a[c];Object.keys(i).forEach(p=>{var m;(e===Y||e===p)&&((m=i[p])[f]||(m[f]=[...Ve(n[p],f)||Ve(n[Y],f)||[]]),i[p][f].push([r,s-l+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(h(this,Ne)).concat(Object.keys(h(this,je))).forEach(t=>{e[t]||(e[t]=F(this,Et,hr).call(this,t))}),w(this,je,w(this,Ne,void 0)),Jr(),e}},je=new WeakMap,Ne=new WeakMap,Et=new WeakSet,hr=function(e){const t=[];let r=e===Y;return[h(this,je),h(this,Ne)].forEach(n=>{const i=n[e]?Object.keys(n[e]).map(s=>[s,n[e][s]]):[];i.length!==0?(r||(r=!0),t.push(...i)):e!==Y&&t.push(...Object.keys(n[Y]).map(s=>[s,n[Y][s]]))}),r?Kr(t):null},Jt),De,_e,Kt,Yr=(Kt=class{constructor(e){_(this,"name","SmartRouter");O(this,De,[]);O(this,_e,[]);w(this,De,e.routers)}add(e,t,r){if(!h(this,_e))throw new Error(ar);h(this,_e).push([e,t,r])}match(e,t){if(!h(this,_e))throw new Error("Fatal error");const r=h(this,De),n=h(this,_e),i=r.length;let s=0,a;for(;s<i;s++){const o=r[s];try{for(let c=0,l=n.length;c<l;c++)o.add(...n[c]);a=o.match(e,t)}catch(c){if(c instanceof or)continue;throw c}this.match=o.match.bind(o),w(this,De,[o]),w(this,_e,void 0);break}if(s===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(h(this,_e)||h(this,De).length!==1)throw new Error("No active router has been determined yet.");return h(this,De)[0]}},De=new WeakMap,_e=new WeakMap,Kt),it=Object.create(null),Ie,ne,ze,et,ee,Ee,Fe,Gt,fr=(Gt=class{constructor(e,t,r){O(this,Ee);O(this,Ie);O(this,ne);O(this,ze);O(this,et,0);O(this,ee,it);if(w(this,ne,r||Object.create(null)),w(this,Ie,[]),e&&t){const n=Object.create(null);n[e]={handler:t,possibleKeys:[],score:0},w(this,Ie,[n])}w(this,ze,[])}insert(e,t,r){w(this,et,++It(this,et)._);let n=this;const i=Or(t),s=[];for(let a=0,o=i.length;a<o;a++){const c=i[a],l=i[a+1],f=Ar(c,l),p=Array.isArray(f)?f[0]:c;if(p in h(n,ne)){n=h(n,ne)[p],f&&s.push(f[1]);continue}h(n,ne)[p]=new fr,f&&(h(n,ze).push(f),s.push(f[1])),n=h(n,ne)[p]}return h(n,Ie).push({[e]:{handler:r,possibleKeys:s.filter((a,o,c)=>c.indexOf(a)===o),score:h(this,et)}}),n}search(e,t){var o;const r=[];w(this,ee,it);let i=[this];const s=Qt(t),a=[];for(let c=0,l=s.length;c<l;c++){const f=s[c],p=c===l-1,m=[];for(let v=0,I=i.length;v<I;v++){const A=i[v],$=h(A,ne)[f];$&&(w($,ee,h(A,ee)),p?(h($,ne)["*"]&&r.push(...F(this,Ee,Fe).call(this,h($,ne)["*"],e,h(A,ee))),r.push(...F(this,Ee,Fe).call(this,$,e,h(A,ee)))):m.push($));for(let H=0,Ce=h(A,ze).length;H<Ce;H++){const Oe=h(A,ze)[H],ae=h(A,ee)===it?{}:{...h(A,ee)};if(Oe==="*"){const g=h(A,ne)["*"];g&&(r.push(...F(this,Ee,Fe).call(this,g,e,h(A,ee))),w(g,ee,ae),m.push(g));continue}const[Me,de,M]=Oe;if(!f&&!(M instanceof RegExp))continue;const u=h(A,ne)[Me],d=s.slice(c).join("/");if(M instanceof RegExp){const g=M.exec(d);if(g){if(ae[de]=g[0],r.push(...F(this,Ee,Fe).call(this,u,e,h(A,ee),ae)),Object.keys(h(u,ne)).length){w(u,ee,ae);const y=((o=g[0].match(/\//))==null?void 0:o.length)??0;(a[y]||(a[y]=[])).push(u)}continue}}(M===!0||M.test(f))&&(ae[de]=f,p?(r.push(...F(this,Ee,Fe).call(this,u,e,ae,h(A,ee))),h(u,ne)["*"]&&r.push(...F(this,Ee,Fe).call(this,h(u,ne)["*"],e,ae,h(A,ee)))):(w(u,ee,ae),m.push(u)))}}i=m.concat(a.shift()??[])}return r.length>1&&r.sort((c,l)=>c.score-l.score),[r.map(({handler:c,params:l})=>[c,l])]}},Ie=new WeakMap,ne=new WeakMap,ze=new WeakMap,et=new WeakMap,ee=new WeakMap,Ee=new WeakSet,Fe=function(e,t,r,n){const i=[];for(let s=0,a=h(e,Ie).length;s<a;s++){const o=h(e,Ie)[s],c=o[t]||o[Y],l={};if(c!==void 0&&(c.params=Object.create(null),i.push(c),r!==it||n&&n!==it))for(let f=0,p=c.possibleKeys.length;f<p;f++){const m=c.possibleKeys[f],v=l[c.score];c.params[m]=n!=null&&n[m]&&!v?n[m]:r[m]??(n==null?void 0:n[m]),l[c.score]=!0}}return i},Gt),Ue,Yt,Qr=(Yt=class{constructor(){_(this,"name","TrieRouter");O(this,Ue);w(this,Ue,new fr)}add(e,t,r){const n=Zt(t);if(n){for(let i=0,s=n.length;i<s;i++)h(this,Ue).insert(e,n[i],r);return}h(this,Ue).insert(e,t,r)}match(e,t){return h(this,Ue).search(e,t)}},Ue=new WeakMap,Yt),tt=class extends lr{constructor(e={}){super(e),this.router=e.router??new Yr({routers:[new Gr,new Qr]})}},Xr=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(s=>typeof s=="string"?s==="*"?()=>s:a=>s===a?a:null:typeof s=="function"?s:a=>s.includes(a)?a:null)(r.origin),i=(s=>typeof s=="function"?s:Array.isArray(s)?()=>s:()=>[])(r.allowMethods);return async function(a,o){var f;function c(p,m){a.res.headers.set(p,m)}const l=await n(a.req.header("origin")||"",a);if(l&&c("Access-Control-Allow-Origin",l),r.origin!=="*"){const p=a.req.header("Vary");p?c("Vary",p):c("Vary","Origin")}if(r.credentials&&c("Access-Control-Allow-Credentials","true"),(f=r.exposeHeaders)!=null&&f.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const p=await i(a.req.header("origin")||"",a);p.length&&c("Access-Control-Allow-Methods",p.join(","));let m=r.allowHeaders;if(!(m!=null&&m.length)){const v=a.req.header("Access-Control-Request-Headers");v&&(m=v.split(/\s*,\s*/))}return m!=null&&m.length&&(c("Access-Control-Allow-Headers",m.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await o()}},Zr=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Ft=(e,t=tn)=>{const r=/\.([a-zA-Z0-9]+?)$/,n=e.match(r);if(!n)return;let i=t[n[1]];return i&&i.startsWith("text")&&(i+="; charset=utf-8"),i},en={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},tn=en,rn=(...e)=>{let t=e.filter(i=>i!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),n=[];for(const i of r)i===".."&&n.length>0&&n.at(-1)!==".."?n.pop():i!=="."&&n.push(i);return n.join("/")||"."},pr={br:".br",zstd:".zst",gzip:".gz"},nn=Object.keys(pr),sn="index.html",an=e=>{const t=e.root??"./",r=e.path,n=e.join??rn;return async(i,s)=>{var f,p,m,v;if(i.finalized)return s();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(i.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((f=e.onNotFound)==null?void 0:f.call(e,i.req.path,i)),s()}let o=n(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(o)&&(o=n(o,sn));const c=e.getContent;let l=await c(o,i);if(l instanceof Response)return i.newResponse(l.body,l);if(l){const I=e.mimes&&Ft(o,e.mimes)||Ft(o);if(i.header("Content-Type",I||"application/octet-stream"),e.precompressed&&(!I||Zr.test(I))){const A=new Set((p=i.req.header("Accept-Encoding"))==null?void 0:p.split(",").map($=>$.trim()));for(const $ of nn){if(!A.has($))continue;const H=await c(o+pr[$],i);if(H){l=H,i.header("Content-Encoding",$),i.header("Vary","Accept-Encoding",{append:!0});break}}}return await((m=e.onFound)==null?void 0:m.call(e,o,i)),i.body(l)}await((v=e.onNotFound)==null?void 0:v.call(e,o,i)),await s()}},on=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let n;t&&t.namespace?n=t.namespace:n=__STATIC_CONTENT;const i=r[e]||e;if(!i)return null;const s=await n.get(i,{type:"stream"});return s||null},ln=e=>async function(r,n){return an({...e,getContent:async s=>on(s,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,n)},cn=e=>ln(e);function un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xt={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var dn=xt.exports,qt;function hn(){return qt||(qt=1,(function(e,t){((r,n)=>{e.exports=n()})(dn,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},i,s=!n.document&&!!n.postMessage,a=n.IS_PAPA_WORKER||!1,o={},c=0,l={};function f(u){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(d){var g=Me(d);g.chunkSize=parseInt(g.chunkSize),d.step||d.chunk||(g.chunkSize=null),this._handle=new A(g),(this._handle.streamer=this)._config=g}).call(this,u),this.parseChunk=function(d,g){var y=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<y){let T=this._config.newline;T||(b=this._config.quoteChar||'"',T=this._handle.guessLineEndings(d,b)),d=[...d.split(T).slice(y)].join(T)}this.isFirstChunk&&M(this._config.beforeFirstChunk)&&(b=this._config.beforeFirstChunk(d))!==void 0&&(d=b),this.isFirstChunk=!1,this._halted=!1;var y=this._partialLine+d,b=(this._partialLine="",this._handle.parse(y,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(d=b.meta.cursor,y=(this._finished||(this._partialLine=y.substring(d-this._baseIndex),this._baseIndex=d),b&&b.data&&(this._rowCount+=b.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),a)n.postMessage({results:b,workerId:l.WORKER_ID,finished:y});else if(M(this._config.chunk)&&!g){if(this._config.chunk(b,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=b=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(b.data),this._completeResults.errors=this._completeResults.errors.concat(b.errors),this._completeResults.meta=b.meta),this._completed||!y||!M(this._config.complete)||b&&b.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),y||b&&b.meta.paused||this._nextChunk(),b}this._halted=!0},this._sendError=function(d){M(this._config.error)?this._config.error(d):a&&this._config.error&&n.postMessage({workerId:l.WORKER_ID,error:d,finished:!1})}}function p(u){var d;(u=u||{}).chunkSize||(u.chunkSize=l.RemoteChunkSize),f.call(this,u),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(g){this._input=g,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(d=new XMLHttpRequest,this._config.withCredentials&&(d.withCredentials=this._config.withCredentials),s||(d.onload=de(this._chunkLoaded,this),d.onerror=de(this._chunkError,this)),d.open(this._config.downloadRequestBody?"POST":"GET",this._input,!s),this._config.downloadRequestHeaders){var g,y=this._config.downloadRequestHeaders;for(g in y)d.setRequestHeader(g,y[g])}var b;this._config.chunkSize&&(b=this._start+this._config.chunkSize-1,d.setRequestHeader("Range","bytes="+this._start+"-"+b));try{d.send(this._config.downloadRequestBody)}catch(T){this._chunkError(T.message)}s&&d.status===0&&this._chunkError()}},this._chunkLoaded=function(){d.readyState===4&&(d.status<200||400<=d.status?this._chunkError():(this._start+=this._config.chunkSize||d.responseText.length,this._finished=!this._config.chunkSize||this._start>=(g=>(g=g.getResponseHeader("Content-Range"))!==null?parseInt(g.substring(g.lastIndexOf("/")+1)):-1)(d),this.parseChunk(d.responseText)))},this._chunkError=function(g){g=d.statusText||g,this._sendError(new Error(g))}}function m(u){(u=u||{}).chunkSize||(u.chunkSize=l.LocalChunkSize),f.call(this,u);var d,g,y=typeof FileReader<"u";this.stream=function(b){this._input=b,g=b.slice||b.webkitSlice||b.mozSlice,y?((d=new FileReader).onload=de(this._chunkLoaded,this),d.onerror=de(this._chunkError,this)):d=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var b=this._input,T=(this._config.chunkSize&&(T=Math.min(this._start+this._config.chunkSize,this._input.size),b=g.call(b,this._start,T)),d.readAsText(b,this._config.encoding));y||this._chunkLoaded({target:{result:T}})},this._chunkLoaded=function(b){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(b.target.result)},this._chunkError=function(){this._sendError(d.error)}}function v(u){var d;f.call(this,u=u||{}),this.stream=function(g){return d=g,this._nextChunk()},this._nextChunk=function(){var g,y;if(!this._finished)return g=this._config.chunkSize,d=g?(y=d.substring(0,g),d.substring(g)):(y=d,""),this._finished=!d,this.parseChunk(y)}}function I(u){f.call(this,u=u||{});var d=[],g=!0,y=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(b){this._input=b,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){y&&d.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),d.length?this.parseChunk(d.shift()):g=!0},this._streamData=de(function(b){try{d.push(typeof b=="string"?b:b.toString(this._config.encoding)),g&&(g=!1,this._checkIsFinished(),this.parseChunk(d.shift()))}catch(T){this._streamError(T)}},this),this._streamError=de(function(b){this._streamCleanUp(),this._sendError(b)},this),this._streamEnd=de(function(){this._streamCleanUp(),y=!0,this._streamData("")},this),this._streamCleanUp=de(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function A(u){var d,g,y,b,T=Math.pow(2,53),J=-T,oe=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,le=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,k=this,U=0,E=0,te=!1,S=!1,j=[],x={data:[],errors:[],meta:{}};function K(N){return u.skipEmptyLines==="greedy"?N.join("").trim()==="":N.length===1&&N[0].length===0}function V(){if(x&&y&&(ce("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),y=!1),u.skipEmptyLines&&(x.data=x.data.filter(function(R){return!K(R)})),Z()){let R=function(W,G){M(u.transformHeader)&&(W=u.transformHeader(W,G)),j.push(W)};if(x)if(Array.isArray(x.data[0])){for(var N=0;Z()&&N<x.data.length;N++)x.data[N].forEach(R);x.data.splice(0,1)}else x.data.forEach(R)}function P(R,W){for(var G=u.header?{}:[],q=0;q<R.length;q++){var L=q,D=R[q],D=((he,C)=>(z=>(u.dynamicTypingFunction&&u.dynamicTyping[z]===void 0&&(u.dynamicTyping[z]=u.dynamicTypingFunction(z)),(u.dynamicTyping[z]||u.dynamicTyping)===!0))(he)?C==="true"||C==="TRUE"||C!=="false"&&C!=="FALSE"&&((z=>{if(oe.test(z)&&(z=parseFloat(z),J<z&&z<T))return 1})(C)?parseFloat(C):le.test(C)?new Date(C):C===""?null:C):C)(L=u.header?q>=j.length?"__parsed_extra":j[q]:L,D=u.transform?u.transform(D,L):D);L==="__parsed_extra"?(G[L]=G[L]||[],G[L].push(D)):G[L]=D}return u.header&&(q>j.length?ce("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+q,E+W):q<j.length&&ce("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+q,E+W)),G}var B;x&&(u.header||u.dynamicTyping||u.transform)&&(B=1,!x.data.length||Array.isArray(x.data[0])?(x.data=x.data.map(P),B=x.data.length):x.data=P(x.data,0),u.header&&x.meta&&(x.meta.fields=j),E+=B)}function Z(){return u.header&&j.length===0}function ce(N,P,B,R){N={type:N,code:P,message:B},R!==void 0&&(N.row=R),x.errors.push(N)}M(u.step)&&(b=u.step,u.step=function(N){x=N,Z()?V():(V(),x.data.length!==0&&(U+=N.data.length,u.preview&&U>u.preview?g.abort():(x.data=x.data[0],b(x,k))))}),this.parse=function(N,P,B){var R=u.quoteChar||'"',R=(u.newline||(u.newline=this.guessLineEndings(N,R)),y=!1,u.delimiter?M(u.delimiter)&&(u.delimiter=u.delimiter(N),x.meta.delimiter=u.delimiter):((R=((W,G,q,L,D)=>{var he,C,z,Te;D=D||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var Be=0;Be<D.length;Be++){for(var me,nt=D[Be],re=0,ye=0,X=0,ie=(z=void 0,new H({comments:L,delimiter:nt,newline:G,preview:10}).parse(W)),ve=0;ve<ie.data.length;ve++)q&&K(ie.data[ve])?X++:(me=ie.data[ve].length,ye+=me,z===void 0?z=me:0<me&&(re+=Math.abs(me-z),z=me));0<ie.data.length&&(ye/=ie.data.length-X),(C===void 0||re<=C)&&(Te===void 0||Te<ye)&&1.99<ye&&(C=re,he=nt,Te=ye)}return{successful:!!(u.delimiter=he),bestDelimiter:he}})(N,u.newline,u.skipEmptyLines,u.comments,u.delimitersToGuess)).successful?u.delimiter=R.bestDelimiter:(y=!0,u.delimiter=l.DefaultDelimiter),x.meta.delimiter=u.delimiter),Me(u));return u.preview&&u.header&&R.preview++,d=N,g=new H(R),x=g.parse(d,P,B),V(),te?{meta:{paused:!0}}:x||{meta:{paused:!1}}},this.paused=function(){return te},this.pause=function(){te=!0,g.abort(),d=M(u.chunk)?"":d.substring(g.getCharIndex())},this.resume=function(){k.streamer._halted?(te=!1,k.streamer.parseChunk(d,!0)):setTimeout(k.resume,3)},this.aborted=function(){return S},this.abort=function(){S=!0,g.abort(),x.meta.aborted=!0,M(u.complete)&&u.complete(x),d=""},this.guessLineEndings=function(W,R){W=W.substring(0,1048576);var R=new RegExp($(R)+"([^]*?)"+$(R),"gm"),B=(W=W.replace(R,"")).split("\r"),R=W.split(`
`),W=1<R.length&&R[0].length<B[0].length;if(B.length===1||W)return`
`;for(var G=0,q=0;q<B.length;q++)B[q][0]===`
`&&G++;return G>=B.length/2?`\r
`:"\r"}}function $(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(u){var d=(u=u||{}).delimiter,g=u.newline,y=u.comments,b=u.step,T=u.preview,J=u.fastMode,oe=null,le=!1,k=u.quoteChar==null?'"':u.quoteChar,U=k;if(u.escapeChar!==void 0&&(U=u.escapeChar),(typeof d!="string"||-1<l.BAD_DELIMITERS.indexOf(d))&&(d=","),y===d)throw new Error("Comment character same as delimiter");y===!0?y="#":(typeof y!="string"||-1<l.BAD_DELIMITERS.indexOf(y))&&(y=!1),g!==`
`&&g!=="\r"&&g!==`\r
`&&(g=`
`);var E=0,te=!1;this.parse=function(S,j,x){if(typeof S!="string")throw new Error("Input must be a string");var K=S.length,V=d.length,Z=g.length,ce=y.length,N=M(b),P=[],B=[],R=[],W=E=0;if(!S)return re();if(J||J!==!1&&S.indexOf(k)===-1){for(var G=S.split(g),q=0;q<G.length;q++){if(R=G[q],E+=R.length,q!==G.length-1)E+=g.length;else if(x)return re();if(!y||R.substring(0,ce)!==y){if(N){if(P=[],Te(R.split(d)),ye(),te)return re()}else Te(R.split(d));if(T&&T<=q)return P=P.slice(0,T),re(!0)}}return re()}for(var L=S.indexOf(d,E),D=S.indexOf(g,E),he=new RegExp($(U)+$(k),"g"),C=S.indexOf(k,E);;)if(S[E]===k)for(C=E,E++;;){if((C=S.indexOf(k,C+1))===-1)return x||B.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:P.length,index:E}),me();if(C===K-1)return me(S.substring(E,C).replace(he,k));if(k===U&&S[C+1]===U)C++;else if(k===U||C===0||S[C-1]!==U){L!==-1&&L<C+1&&(L=S.indexOf(d,C+1));var z=Be((D=D!==-1&&D<C+1?S.indexOf(g,C+1):D)===-1?L:Math.min(L,D));if(S.substr(C+1+z,V)===d){R.push(S.substring(E,C).replace(he,k)),S[E=C+1+z+V]!==k&&(C=S.indexOf(k,E)),L=S.indexOf(d,E),D=S.indexOf(g,E);break}if(z=Be(D),S.substring(C+1+z,C+1+z+Z)===g){if(R.push(S.substring(E,C).replace(he,k)),nt(C+1+z+Z),L=S.indexOf(d,E),C=S.indexOf(k,E),N&&(ye(),te))return re();if(T&&P.length>=T)return re(!0);break}B.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:P.length,index:E}),C++}}else if(y&&R.length===0&&S.substring(E,E+ce)===y){if(D===-1)return re();E=D+Z,D=S.indexOf(g,E),L=S.indexOf(d,E)}else if(L!==-1&&(L<D||D===-1))R.push(S.substring(E,L)),E=L+V,L=S.indexOf(d,E);else{if(D===-1)break;if(R.push(S.substring(E,D)),nt(D+Z),N&&(ye(),te))return re();if(T&&P.length>=T)return re(!0)}return me();function Te(X){P.push(X),W=E}function Be(X){var ie=0;return ie=X!==-1&&(X=S.substring(C+1,X))&&X.trim()===""?X.length:ie}function me(X){return x||(X===void 0&&(X=S.substring(E)),R.push(X),E=K,Te(R),N&&ye()),re()}function nt(X){E=X,Te(R),R=[],D=S.indexOf(g,E)}function re(X){if(u.header&&!j&&P.length&&!le){var ie=P[0],ve=Object.create(null),Rt=new Set(ie);let jt=!1;for(let We=0;We<ie.length;We++){let be=ie[We];if(ve[be=M(u.transformHeader)?u.transformHeader(be,We):be]){let st,Nt=ve[be];for(;st=be+"_"+Nt,Nt++,Rt.has(st););Rt.add(st),ie[We]=st,ve[be]++,jt=!0,(oe=oe===null?{}:oe)[st]=be}else ve[be]=1,ie[We]=be;Rt.add(be)}jt&&console.warn("Duplicate headers found and renamed."),le=!0}return{data:P,errors:B,meta:{delimiter:d,linebreak:g,aborted:te,truncated:!!X,cursor:W+(j||0),renamedHeaders:oe}}}function ye(){b(re()),P=[],B=[]}},this.abort=function(){te=!0},this.getCharIndex=function(){return E}}function Ce(u){var d=u.data,g=o[d.workerId],y=!1;if(d.error)g.userError(d.error,d.file);else if(d.results&&d.results.data){var b={abort:function(){y=!0,Oe(d.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ae,resume:ae};if(M(g.userStep)){for(var T=0;T<d.results.data.length&&(g.userStep({data:d.results.data[T],errors:d.results.errors,meta:d.results.meta},b),!y);T++);delete d.results}else M(g.userChunk)&&(g.userChunk(d.results,b,d.file),delete d.results)}d.finished&&!y&&Oe(d.workerId,d.results)}function Oe(u,d){var g=o[u];M(g.userComplete)&&g.userComplete(d),g.terminate(),delete o[u]}function ae(){throw new Error("Not implemented.")}function Me(u){if(typeof u!="object"||u===null)return u;var d,g=Array.isArray(u)?[]:{};for(d in u)g[d]=Me(u[d]);return g}function de(u,d){return function(){u.apply(d,arguments)}}function M(u){return typeof u=="function"}return l.parse=function(u,d){var g=(d=d||{}).dynamicTyping||!1;if(M(g)&&(d.dynamicTypingFunction=g,g={}),d.dynamicTyping=g,d.transform=!!M(d.transform)&&d.transform,!d.worker||!l.WORKERS_SUPPORTED)return g=null,l.NODE_STREAM_INPUT,typeof u=="string"?(u=(y=>y.charCodeAt(0)!==65279?y:y.slice(1))(u),g=new(d.download?p:v)(d)):u.readable===!0&&M(u.read)&&M(u.on)?g=new I(d):(n.File&&u instanceof File||u instanceof Object)&&(g=new m(d)),g.stream(u);(g=(()=>{var y;return!!l.WORKERS_SUPPORTED&&(y=(()=>{var b=n.URL||n.webkitURL||null,T=r.toString();return l.BLOB_URL||(l.BLOB_URL=b.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",T,")();"],{type:"text/javascript"})))})(),(y=new n.Worker(y)).onmessage=Ce,y.id=c++,o[y.id]=y)})()).userStep=d.step,g.userChunk=d.chunk,g.userComplete=d.complete,g.userError=d.error,d.step=M(d.step),d.chunk=M(d.chunk),d.complete=M(d.complete),d.error=M(d.error),delete d.worker,g.postMessage({input:u,config:d,workerId:g.id})},l.unparse=function(u,d){var g=!1,y=!0,b=",",T=`\r
`,J='"',oe=J+J,le=!1,k=null,U=!1,E=((()=>{if(typeof d=="object"){if(typeof d.delimiter!="string"||l.BAD_DELIMITERS.filter(function(j){return d.delimiter.indexOf(j)!==-1}).length||(b=d.delimiter),typeof d.quotes!="boolean"&&typeof d.quotes!="function"&&!Array.isArray(d.quotes)||(g=d.quotes),typeof d.skipEmptyLines!="boolean"&&typeof d.skipEmptyLines!="string"||(le=d.skipEmptyLines),typeof d.newline=="string"&&(T=d.newline),typeof d.quoteChar=="string"&&(J=d.quoteChar),typeof d.header=="boolean"&&(y=d.header),Array.isArray(d.columns)){if(d.columns.length===0)throw new Error("Option columns is empty");k=d.columns}d.escapeChar!==void 0&&(oe=d.escapeChar+J),d.escapeFormulae instanceof RegExp?U=d.escapeFormulae:typeof d.escapeFormulae=="boolean"&&d.escapeFormulae&&(U=/^[=+\-@\t\r].*$/)}})(),new RegExp($(J),"g"));if(typeof u=="string"&&(u=JSON.parse(u)),Array.isArray(u)){if(!u.length||Array.isArray(u[0]))return te(null,u,le);if(typeof u[0]=="object")return te(k||Object.keys(u[0]),u,le)}else if(typeof u=="object")return typeof u.data=="string"&&(u.data=JSON.parse(u.data)),Array.isArray(u.data)&&(u.fields||(u.fields=u.meta&&u.meta.fields||k),u.fields||(u.fields=Array.isArray(u.data[0])?u.fields:typeof u.data[0]=="object"?Object.keys(u.data[0]):[]),Array.isArray(u.data[0])||typeof u.data[0]=="object"||(u.data=[u.data])),te(u.fields||[],u.data||[],le);throw new Error("Unable to serialize unrecognized input");function te(j,x,K){var V="",Z=(typeof j=="string"&&(j=JSON.parse(j)),typeof x=="string"&&(x=JSON.parse(x)),Array.isArray(j)&&0<j.length),ce=!Array.isArray(x[0]);if(Z&&y){for(var N=0;N<j.length;N++)0<N&&(V+=b),V+=S(j[N],N);0<x.length&&(V+=T)}for(var P=0;P<x.length;P++){var B=(Z?j:x[P]).length,R=!1,W=Z?Object.keys(x[P]).length===0:x[P].length===0;if(K&&!Z&&(R=K==="greedy"?x[P].join("").trim()==="":x[P].length===1&&x[P][0].length===0),K==="greedy"&&Z){for(var G=[],q=0;q<B;q++){var L=ce?j[q]:q;G.push(x[P][L])}R=G.join("").trim()===""}if(!R){for(var D=0;D<B;D++){0<D&&!W&&(V+=b);var he=Z&&ce?j[D]:D;V+=S(x[P][he],D)}P<x.length-1&&(!K||0<B&&!W)&&(V+=T)}}return V}function S(j,x){var K,V;return j==null?"":j.constructor===Date?JSON.stringify(j).slice(1,25):(V=!1,U&&typeof j=="string"&&U.test(j)&&(j="'"+j,V=!0),K=j.toString().replace(E,oe),(V=V||g===!0||typeof g=="function"&&g(j,x)||Array.isArray(g)&&g[x]||((Z,ce)=>{for(var N=0;N<ce.length;N++)if(-1<Z.indexOf(ce[N]))return!0;return!1})(K,l.BAD_DELIMITERS)||-1<K.indexOf(b)||K.charAt(0)===" "||K.charAt(K.length-1)===" ")?J+K+J:K)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!s&&!!n.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=H,l.ParserHandle=A,l.NetworkStreamer=p,l.FileStreamer=m,l.StringStreamer=v,l.ReadableStreamStreamer=I,n.jQuery&&((i=n.jQuery).fn.parse=function(u){var d=u.config||{},g=[];return this.each(function(T){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var J=0;J<this.files.length;J++)g.push({file:this.files[J],inputElem:this,instanceConfig:i.extend({},d)})}),y(),this;function y(){if(g.length===0)M(u.complete)&&u.complete();else{var T,J,oe,le,k=g[0];if(M(u.before)){var U=u.before(k.file,k.inputElem);if(typeof U=="object"){if(U.action==="abort")return T="AbortError",J=k.file,oe=k.inputElem,le=U.reason,void(M(u.error)&&u.error({name:T},J,oe,le));if(U.action==="skip")return void b();typeof U.config=="object"&&(k.instanceConfig=i.extend(k.instanceConfig,U.config))}else if(U==="skip")return void b()}var E=k.instanceConfig.complete;k.instanceConfig.complete=function(te){M(E)&&E(te,k.file,k.inputElem),b()},l.parse(k.file,k.instanceConfig)}}function b(){g.splice(0,1),y()}}),a&&(n.onmessage=function(u){u=u.data,l.WORKER_ID===void 0&&u&&(l.WORKER_ID=u.workerId),typeof u.input=="string"?n.postMessage({workerId:l.WORKER_ID,results:l.parse(u.input,u.config),finished:!0}):(n.File&&u.input instanceof File||u.input instanceof Object)&&(u=l.parse(u.input,u.config))&&n.postMessage({workerId:l.WORKER_ID,results:u,finished:!0})}),(p.prototype=Object.create(f.prototype)).constructor=p,(m.prototype=Object.create(f.prototype)).constructor=m,(v.prototype=Object.create(v.prototype)).constructor=v,(I.prototype=Object.create(f.prototype)).constructor=I,l})})(xt)),xt.exports}var fn=hn();const pn=un(fn);function gn(e){const t=pn.parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,transformHeader:r=>r.trim()});return t.errors.length>0&&console.warn("CSV parsing warnings:",t.errors.slice(0,5)),t.data}function mn(e){if(e.length===0)return{};const t=Object.keys(e[0]),r={};for(const n of t){const i=e.slice(0,Math.min(100,e.length)).map(s=>s[n]);r[n]=yn(i)}return r}function yn(e){const t=e.filter(s=>s!=null&&s!=="");if(t.length===0)return"string";if(t.filter(s=>typeof s=="number").length===t.length)return"number";if(t.filter(s=>typeof s=="boolean").length===t.length)return"boolean";const i=t.filter(s=>{if(typeof s=="string"){const a=Date.parse(s);return!isNaN(a)}return!1}).length;return i===t.length&&i>0?"date":"string"}const gr=new tt;gr.post("/",async e=>{try{const r=(await e.req.formData()).get("file");if(!r)return e.json({error:"No file provided"},400);const n=r.name,i=n.endsWith(".csv")?"csv":n.endsWith(".json")?"json":null;if(!i)return e.json({error:"Unsupported file type. Please upload CSV or JSON."},400);if(r.size>5*1024*1024)return e.json({error:"File too large. Maximum size is 5MB."},400);const s=await r.text();let a;if(i==="csv")a=gn(s);else try{const p=JSON.parse(s);a=Array.isArray(p)?p:[p]}catch{return e.json({error:"Invalid JSON format"},400)}if(a.length===0)return e.json({error:"File contains no data"},400);if(a.length>1e4)return e.json({error:"Dataset too large. Maximum 10,000 rows supported."},400);const o=mn(a),c=Object.keys(a[0]).map(p=>({name:p,type:o[p]||"string",nullable:a.some(m=>m[p]===null||m[p]===void 0||m[p]===""),unique_count:new Set(a.map(m=>m[p])).size,sample_values:a.slice(0,3).map(m=>m[p])})),f=(await e.env.DB.prepare(`
      INSERT INTO datasets (name, original_filename, file_type, row_count, column_count, columns, analysis_status)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(n.replace(/\.[^.]+$/,""),n,i,a.length,c.length,JSON.stringify(c),"analyzing").run()).meta.last_row_id;for(let p=0;p<a.length;p++)await e.env.DB.prepare(`
        INSERT INTO data_rows (dataset_id, row_number, data, is_cleaned)
        VALUES (?, ?, ?, ?)
      `).bind(f,p,JSON.stringify(a[p]),0).run();return e.json({success:!0,dataset_id:f,message:"Upload successful. Analysis started.",row_count:a.length,column_count:c.length,columns:c})}catch(t){return console.error("Upload error:",t),e.json({error:"Upload failed: "+t.message},500)}});const rt=new tt;rt.get("/",async e=>{try{const r=(await e.env.DB.prepare(`
      SELECT * FROM datasets ORDER BY upload_date DESC
    `).all()).results.map(n=>({...n,columns:JSON.parse(n.columns)}));return e.json({datasets:r})}catch{return e.json({error:"Failed to fetch datasets"},500)}});rt.get("/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare(`
      SELECT * FROM datasets WHERE id = ?
    `).bind(t).first();if(!r)return e.json({error:"Dataset not found"},404);const i=(await e.env.DB.prepare(`
      SELECT data FROM data_rows WHERE dataset_id = ? AND is_cleaned = 0 LIMIT 10
    `).bind(t).all()).results.map(s=>JSON.parse(s.data));return e.json({dataset:{...r,columns:JSON.parse(r.columns)},sample:i})}catch{return e.json({error:"Failed to fetch dataset"},500)}});rt.get("/:id/analyses",async e=>{try{const t=e.req.param("id"),n=(await e.env.DB.prepare(`
      SELECT * FROM analyses WHERE dataset_id = ? ORDER BY quality_score DESC, confidence DESC
    `).bind(t).all()).results.map(i=>({...i,result:JSON.parse(i.result)}));return e.json({analyses:n})}catch{return e.json({error:"Failed to fetch analyses"},500)}});rt.get("/:id/visualizations",async e=>{try{const t=e.req.param("id"),n=(await e.env.DB.prepare(`
      SELECT * FROM visualizations WHERE dataset_id = ? ORDER BY display_order
    `).bind(t).all()).results.map(i=>({...i,config:JSON.parse(i.config)}));return e.json({visualizations:n})}catch{return e.json({error:"Failed to fetch visualizations"},500)}});rt.delete("/:id",async e=>{try{const t=e.req.param("id");return await e.env.DB.prepare(`
      DELETE FROM datasets WHERE id = ?
    `).bind(t).run(),e.json({success:!0,message:"Dataset deleted"})}catch{return e.json({error:"Failed to delete dataset"},500)}});function bn(e,t){const r=e.filter(s=>s!=null&&s!==""),n=e.length-r.length,i=new Set(r).size;if(t==="number"){const s=r.map(a=>Number(a)).filter(a=>!isNaN(a));return{count:e.length,mean:$e(s),median:vn(s),mode:Lt(s),stdDev:xn(s),min:Math.min(...s),max:Math.max(...s),q1:ct(s,25),q2:ct(s,50),q3:ct(s,75),nullCount:n,uniqueCount:i}}return{count:e.length,mode:Lt(r),min:r[0],max:r[r.length-1],nullCount:n,uniqueCount:i}}function $e(e){return e.length===0?0:e.reduce((t,r)=>t+r,0)/e.length}function vn(e){if(e.length===0)return 0;const t=[...e].sort((n,i)=>n-i),r=Math.floor(t.length/2);return t.length%2===0?(t[r-1]+t[r])/2:t[r]}function Lt(e){if(e.length===0)return null;const t={};let r=0,n=null;for(const i of e){const s=String(i);t[s]=(t[s]||0)+1,t[s]>r&&(r=t[s],n=i)}return n}function xn(e){if(e.length===0)return 0;const t=$e(e),r=e.map(n=>Math.pow(n-t,2));return Math.sqrt($e(r))}function ct(e,t){if(e.length===0)return 0;const r=[...e].sort((o,c)=>o-c),n=t/100*(r.length-1),i=Math.floor(n),s=Math.ceil(n),a=n%1;return i===s?r[i]:r[i]*(1-a)+r[s]*a}function wn(e){if(e.length<4)return{indices:[],threshold:0};const t=ct(e,25),r=ct(e,75),n=r-t,i=t-1.5*n,s=r+1.5*n,a=[];return e.forEach((o,c)=>{(o<i||o>s)&&a.push(c)}),{indices:a,threshold:n}}function _n(e,t){if(e.length!==t.length||e.length===0)return 0;const r=e.length,n=$e(e),i=$e(t);let s=0,a=0,o=0;for(let c=0;c<r;c++){const l=e[c]-n,f=t[c]-i;s+=l*f,a+=l*l,o+=f*f}return a===0||o===0?0:s/Math.sqrt(a*o)}function En(e){if(e.length<2)return{direction:"stable",strength:0};const t=e.length,r=Array.from({length:t},(l,f)=>f),n=$e(r),i=$e(e);let s=0,a=0;for(let l=0;l<t;l++)s+=(r[l]-n)*(e[l]-i),a+=Math.pow(r[l]-n,2);const o=a===0?0:s/a,c=Math.min(Math.abs(o)/($e(e)||1),1);return Math.abs(o)<.01?{direction:"stable",strength:0}:{direction:o>0?"up":"down",strength:c}}function at(e,t,r,n){var a;let i=50;const s=[];if(t){const o=t.toLowerCase();(o.includes("id")||o==="index")&&(i-=30,s.push("Identifier column (typically unique values)")),o.includes("name")&&n.uniqueCount/n.count>.8&&(i-=25,s.push("High cardinality name column")),(o.includes("email")||o.includes("phone")||o.includes("address"))&&(i-=30,s.push("Personal identifier (typically unique)")),(o.includes("time")||o.includes("date"))&&n.uniqueCount/n.count>.9&&(i-=20,s.push("High precision timestamp"))}switch(e){case"statistics":n.uniqueCount===1?(i-=40,s.push("All values are identical")):n.uniqueCount===n.count?(i-=35,s.push("All values are unique (no patterns)")):n.uniqueCount/n.count>.9?(i-=25,s.push("Very high cardinality (few patterns)")):n.uniqueCount/n.count<.1&&(i+=20,s.push("Low cardinality (clear patterns)")),n.stdDev!==void 0&&n.mean!==void 0&&n.stdDev/Math.abs(n.mean||1)>.5&&(i+=15,s.push("High variability in data"));break;case"correlation":const o=Math.abs(r.correlation||0);o>.8?(i+=30,s.push("Very strong correlation")):o>.6?(i+=20,s.push("Strong correlation")):o>.5&&(i+=10,s.push("Moderate correlation"));break;case"outlier":const l=(r.count||0)/(n.count||1);l>.05&&l<.2?(i+=25,s.push("Significant outliers detected")):l>0&&(i+=10,s.push("Some outliers present"));break;case"pattern":const f=(a=r.topPatterns)==null?void 0:a[0];if(f){const[,m]=f,v=m/n.count;v>.3&&v<.9&&(i+=20,s.push("Clear dominant pattern"))}break;case"trend":const p=r.strength||0;p>.5?(i+=30,s.push("Strong trend detected")):p>.3&&(i+=15,s.push("Moderate trend"));break}if(n.nullCount>0){const o=n.nullCount/n.count;o>.5?(i-=30,s.push("More than 50% missing data")):o>.2&&(i-=15,s.push("Significant missing data"))}return i=Math.max(0,Math.min(100,i)),{score:i,reasons:s}}async function Rn(e,t,r,n){console.log(`Starting analysis for dataset ${e}`);for(const s of r){const a=t.map(p=>p[s.name]),o=bn(a,s.type),c=Sn(s.name,s.type,o),l=On(o,s.type),f=at("statistics",s.name,o,o);if(await n.prepare(`
      INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance, quality_score)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(e,"statistics",s.name,JSON.stringify(o),1,c,l,f.score).run(),s.type==="number"){const p=a.map(v=>Number(v)).filter(v=>!isNaN(v)),m=wn(p);if(m.indices.length>0){const v=`Found ${m.indices.length} unusual values in "${s.name}" (${(m.indices.length/p.length*100).toFixed(1)}% of data). These values are significantly different from the rest and might need attention.`,I={count:m.indices.length,indices:m.indices.slice(0,10)},A=at("outlier",s.name,I,o);await n.prepare(`
          INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance, quality_score)
          VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        `).bind(e,"outlier",s.name,JSON.stringify(I),.85,v,m.indices.length>p.length*.05?"high":"medium",A.score).run()}if(p.length>5){const v=En(p);if(v.direction!=="stable"){const I=`"${s.name}" shows a ${v.direction==="up"?"rising":"falling"} trend with ${(v.strength*100).toFixed(0)}% strength. This ${v.direction==="up"?"increase":"decrease"} is consistent across the dataset.`,A=at("trend",s.name,v,o);await n.prepare(`
            INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance, quality_score)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
          `).bind(e,"trend",s.name,JSON.stringify(v),v.strength,I,v.strength>.5?"high":"medium",A.score).run()}}}}const i=r.filter(s=>s.type==="number");for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++){const o=i[s],c=i[a],l=t.map(p=>Number(p[o.name])).filter(p=>!isNaN(p)),f=t.map(p=>Number(p[c.name])).filter(p=>!isNaN(p));if(l.length>5&&f.length>5){const p=_n(l,f);if(Math.abs(p)>.5){const m=Cn(o.name,c.name,p),v={column1:o.name,column2:c.name,correlation:p},I=at("correlation",void 0,v,{count:l.length});await n.prepare(`
            INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance, quality_score)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
          `).bind(e,"correlation",`${o.name}_vs_${c.name}`,JSON.stringify(v),Math.abs(p),m,Math.abs(p)>.7?"high":"medium",I.score).run()}}}for(const s of r)if(s.type==="string"){const a=t.map(f=>f[s.name]).filter(f=>f),o={};a.forEach(f=>{o[f]=(o[f]||0)+1});const l=Object.entries(o).sort((f,p)=>p[1]-f[1]).slice(0,5);if(l.length>0&&l[0][1]>a.length*.1){const f=`The most common value in "${s.name}" is "${l[0][0]}" appearing ${l[0][1]} times (${(l[0][1]/a.length*100).toFixed(1)}% of records).`,p={topPatterns:l},m={count:a.length,uniqueCount:new Set(a).size},v=at("pattern",s.name,p,m);await n.prepare(`
          INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance, quality_score)
          VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        `).bind(e,"pattern",s.name,JSON.stringify(p),.9,f,"medium",v.score).run()}}console.log(`Analysis complete for dataset ${e}`)}function Sn(e,t,r){var n,i,s,a;return t==="number"?`"${e}" ranges from ${(n=r.min)==null?void 0:n.toFixed(2)} to ${(i=r.max)==null?void 0:i.toFixed(2)} with an average of ${(s=r.mean)==null?void 0:s.toFixed(2)}. About half the values are below ${(a=r.median)==null?void 0:a.toFixed(2)}.`:`"${e}" contains ${r.count} values with ${r.uniqueCount} unique entries. Most common: "${r.mode}".`}function Cn(e,t,r){const n=Math.abs(r)>.7?"strong":"moderate";return r>0?`There's a ${n} relationship between "${e}" and "${t}": when ${e} increases, ${t} tends to increase too (correlation: ${r.toFixed(2)}).`:`There's a ${n} inverse relationship between "${e}" and "${t}": when ${e} increases, ${t} tends to decrease (correlation: ${r.toFixed(2)}).`}function On(e,t){return e.nullCount>e.count*.5?"high":e.uniqueCount===1?"low":t==="number"&&e.stdDev>e.mean?"high":"medium"}async function Tn(e,t,r,n){console.log(`Generating visualizations for dataset ${e}`);let i=0;const s=[...r].sort((a,o)=>(o.quality_score||50)-(a.quality_score||50));for(const a of s){if((a.quality_score||50)<30){console.log(`Skipping low-quality visualization for ${a.column_name} (score: ${a.quality_score})`);continue}const o=await kn(a,t);o&&await n.prepare(`
        INSERT INTO visualizations (dataset_id, analysis_id, chart_type, title, config, explanation, display_order)
        VALUES (?, ?, ?, ?, ?, ?, ?)
      `).bind(e,a.id,o.chartType,o.title,JSON.stringify(o.config),o.explanation,i++).run()}console.log(`Generated ${i} visualizations`)}function kn(e,t){switch(e.analysis_type){case"statistics":return An(e,t);case"correlation":return jn(e,t);case"outlier":return Nn(e,t);case"pattern":return Dn(e);case"trend":return In(e,t);default:return null}}function An(e,t){const r=e.column_name;if(!r)return null;if(e.result.mean!==void 0){const o=t.map(l=>Number(l[r])).filter(l=>!isNaN(l)),c=$n(o);return{chartType:"bar",title:`Distribution: ${r}`,explanation:`This histogram shows how values in "${r}" are distributed. Taller bars mean more data points at that value range.`,config:{type:"bar",data:{labels:c.labels,datasets:[{label:"Frequency",data:c.data,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`${r} Distribution`}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Count"}},x:{title:{display:!0,text:r}}}}}}}const i=t.map(o=>o[r]).filter(o=>o!=null),s={};i.forEach(o=>{s[String(o)]=(s[String(o)]||0)+1});const a=Object.entries(s).sort((o,c)=>c[1]-o[1]).slice(0,10);return{chartType:"bar",title:`Top Values: ${r}`,explanation:`This chart shows the most common values in "${r}". The tallest bar is the most frequent value.`,config:{type:"bar",data:{labels:a.map(([o])=>o),datasets:[{label:"Count",data:a.map(([,o])=>o),backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:`Most Common: ${r}`}},scales:{x:{beginAtZero:!0,title:{display:!0,text:"Count"}}}}}}}function jn(e,t){const r=e.result,n=r.column1,i=r.column2;if(!n||!i)return null;const s=t.map(c=>({x:Number(c[n]),y:Number(c[i])})).filter(c=>!isNaN(c.x)&&!isNaN(c.y)),a=r.correlation,o=a>0?"rgba(139, 92, 246, 0.6)":"rgba(239, 68, 68, 0.6)";return{chartType:"scatter",title:`Relationship: ${n} vs ${i}`,explanation:`Each dot represents one record. ${a>0?"The upward pattern shows they move together.":"The downward pattern shows they move in opposite directions."}`,config:{type:"scatter",data:{datasets:[{label:`${n} vs ${i}`,data:s,backgroundColor:o,borderColor:o.replace("0.6","1"),borderWidth:1,pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Correlation: ${a.toFixed(2)}`}},scales:{x:{title:{display:!0,text:n}},y:{title:{display:!0,text:i}}}}}}}function Nn(e,t){const r=e.column_name;if(!r)return null;const n=new Set(e.result.indices||[]),i=t.map((o,c)=>({x:c,y:Number(o[r]),isOutlier:n.has(c)})).filter(o=>!isNaN(o.y)),s=i.filter(o=>!o.isOutlier),a=i.filter(o=>o.isOutlier);return{chartType:"scatter",title:`Outliers: ${r}`,explanation:"Red dots are unusual values that stand out from the pattern. Blue dots are normal values.",config:{type:"scatter",data:{datasets:[{label:"Normal",data:s,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,pointRadius:3},{label:"Outliers",data:a,backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:2,pointRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:`${r} - Outlier Detection`}},scales:{x:{title:{display:!0,text:"Record Index"}},y:{title:{display:!0,text:r}}}}}}}function Dn(e,t){const r=e.column_name;if(!r)return null;const n=e.result.topPatterns||[];if(n.length===0)return null;const i=n.slice(0,8);return{chartType:"pie",title:`Pattern Distribution: ${r}`,explanation:"Each slice shows what percentage of records have that value. Bigger slices are more common.",config:{type:"pie",data:{labels:i.map(([s])=>s),datasets:[{data:i.map(([,s])=>s),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(14, 165, 233, 0.8)","rgba(34, 197, 94, 0.8)"],borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"right"},title:{display:!0,text:`${r} Breakdown`}}}}}}function In(e,t){const r=e.column_name;if(!r)return null;const n=t.map(a=>Number(a[r])).filter(a=>!isNaN(a)),i=e.result,s=i.direction==="up"?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)";return{chartType:"line",title:`Trend: ${r}`,explanation:`This line shows how "${r}" changes over time. ${i.direction==="up"?"The upward slope indicates growth.":"The downward slope indicates decline."}`,config:{type:"line",data:{labels:n.map((a,o)=>`#${o+1}`),datasets:[{label:r,data:n,backgroundColor:s,borderColor:s.replace("0.6","1"),borderWidth:2,fill:!1,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`${r} Over Time (${i.direction==="up"?"":""} ${Math.round(i.strength*100)}% strength)`}},scales:{x:{title:{display:!0,text:"Record Number"}},y:{title:{display:!0,text:r}}}}}}}function $n(e,t=10){if(e.length===0)return{labels:[],data:[]};const r=Math.min(...e),s=(Math.max(...e)-r)/t,a=new Array(t).fill(0),o=[];for(let c=0;c<t;c++){const l=r+c*s,f=r+(c+1)*s;o.push(`${l.toFixed(1)}-${f.toFixed(1)}`)}return e.forEach(c=>{let l=Math.floor((c-r)/s);l>=t&&(l=t-1),l<0&&(l=0),a[l]++}),{labels:o,data:a}}const mr=new tt;mr.post("/:id",async e=>{try{const t=Number(e.req.param("id")),r=await e.env.DB.prepare(`
      SELECT * FROM datasets WHERE id = ?
    `).bind(t).first();if(!r)return e.json({error:"Dataset not found"},404);const i=(await e.env.DB.prepare(`
      SELECT data FROM data_rows WHERE dataset_id = ? AND is_cleaned = 0
    `).bind(t).all()).results.map(c=>JSON.parse(c.data)),s=JSON.parse(r.columns);await Rn(t,i,s,e.env.DB);const o=(await e.env.DB.prepare(`
      SELECT * FROM analyses WHERE dataset_id = ?
    `).bind(t).all()).results.map(c=>({...c,result:JSON.parse(c.result)}));return await Tn(t,i,o,e.env.DB),await e.env.DB.prepare(`
      UPDATE datasets SET analysis_status = ?, visualization_status = ?
      WHERE id = ?
    `).bind("complete","complete",t).run(),e.json({success:!0,message:"Analysis complete",analyses_count:o.length,dataset_id:t})}catch(t){return console.error("Analysis error:",t),e.json({error:"Analysis failed: "+t.message},500)}});const yr=new tt;yr.get("/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare(`
      SELECT * FROM datasets WHERE id = ?
    `).bind(t).first();if(!r)return e.json({error:"Dataset not found"},404);const n=JSON.parse(r.columns),s=(await e.env.DB.prepare(`
      SELECT * FROM analyses WHERE dataset_id = ?
    `).bind(t).all()).results.map(p=>({...p,result:JSON.parse(p.result)})),a=[],o=[],c=new Map;for(const p of n){const m=`col_${p.name}`;if(!c.has(m)){const I=10+p.unique_count/r.row_count*30;a.push({id:m,label:p.name,type:"column",size:I}),c.set(m,!0)}}const l=s.filter(p=>p.analysis_type==="correlation");for(const p of l){const{column1:m,column2:v,correlation:I}=p.result,A=`col_${m}`,$=`col_${v}`;o.push({source:A,target:$,type:"correlation",strength:Math.abs(I),label:`${I>0?"+":""}${I.toFixed(2)}`})}const f=s.filter(p=>p.analysis_type==="pattern"&&(p.quality_score||0)>50);for(const p of f){const m=p.column_name;if(!m)continue;const{topPatterns:v}=p.result;if(!v||v.length===0)continue;const I=v.slice(0,3);for(const[A,$]of I){const H=`val_${m}_${A}`;c.has(H)||(a.push({id:H,label:String(A),type:"value",size:5+$/r.row_count*20}),c.set(H,!0)),o.push({source:`col_${m}`,target:H,type:"contains",strength:$/r.row_count,label:`${$}x`})}}return e.json({nodes:a,edges:o,dataset_name:r.name})}catch(t){return console.error("Relationship graph error:",t),e.json({error:"Failed to generate relationship graph"},500)}});const Se=new tt;Se.use("/api/*",Xr());Se.use("/static/*",cn({root:"./public"}));Se.route("/api/upload",gr);Se.route("/api/datasets",rt);Se.route("/api/analyze",mr);Se.route("/api/relationships",yr);Se.get("/api/health",e=>e.json({status:"ok",timestamp:new Date().toISOString()}));Se.get("/",e=>e.html(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Data Intelligence Platform</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"><\/script>
        <style>
          .upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s;
          }
          .upload-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
          }
          .insight-card {
            animation: slideIn 0.5s ease-out;
          }
          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateY(20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          .importance-high { border-left: 4px solid #ef4444; }
          .importance-medium { border-left: 4px solid #f59e0b; }
          .importance-low { border-left: 4px solid #10b981; }

          /* Print styles for PDF export */
          @media print {
            body { background: white; }
            header { display: none !important; }
            #upload-section { display: none !important; }
            #datasets-section { display: none !important; }
            .no-print { display: none !important; }
            
            #results-section {
              display: block !important;
              margin: 0;
              padding: 20px;
            }

            .bg-white {
              box-shadow: none;
              page-break-inside: avoid;
            }

            h1, h2, h3 {
              color: black !important;
              page-break-after: avoid;
            }

            .insight-card {
              page-break-inside: avoid;
              margin-bottom: 10px;
            }

            /* Ensure charts print properly */
            canvas {
              max-width: 100% !important;
              height: auto !important;
              page-break-inside: avoid;
            }

            /* Add page header */
            @page {
              margin: 1cm;
            }

            #results-section::before {
              content: "Data Intelligence Report";
              display: block;
              font-size: 28px;
              font-weight: bold;
              margin-bottom: 10px;
              padding-bottom: 10px;
              border-bottom: 2px solid #e5e7eb;
              color: #1f2937;
            }

            /* Add timestamp */
            .print-meta {
              display: block !important;
              font-size: 12px;
              color: #6b7280;
              margin-bottom: 20px;
            }
          }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b">
                <div class="max-w-7xl mx-auto px-4 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">
                                <i class="fas fa-brain text-blue-600 mr-3"></i>
                                Data Intelligence Platform
                            </h1>
                            <p class="text-gray-600 mt-1">Upload  Analyze  Understand. Automated insights from your data.</p>
                        </div>
                        <button id="view-datasets" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                            <i class="fas fa-database mr-2"></i>My Datasets
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 py-8">
                <!-- Upload Section -->
                <div id="upload-section" class="mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-upload mr-2 text-blue-600"></i>
                            Upload Your Data
                        </h2>
                        <p class="text-gray-600 mb-6">
                            Drop a CSV or JSON file below and we'll automatically analyze it, find patterns, 
                            and explain what matters in plain English.
                        </p>

                        <div id="upload-area" class="upload-area rounded-lg p-12 text-center cursor-pointer">
                            <input type="file" id="file-input" accept=".csv,.json" class="hidden">
                            <div id="upload-prompt">
                                <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                                <p class="text-xl text-gray-700 mb-2">Drop your file here or click to browse</p>
                                <p class="text-sm text-gray-500">Supports CSV and JSON files</p>
                            </div>
                            <div id="upload-progress" class="hidden">
                                <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                                <p id="status-message" class="text-lg text-gray-700 font-semibold">Uploading...</p>
                                <p id="status-detail" class="text-sm text-gray-500 mt-2"></p>
                                <div class="mt-4 w-64 mx-auto bg-gray-200 rounded-full h-2">
                                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="results-section" class="hidden">
                    <!-- Print Metadata (hidden on screen, visible in print) -->
                    <div class="print-meta hidden">
                        <p id="print-dataset-name"></p>
                        <p id="print-timestamp"></p>
                    </div>

                    <!-- Export Actions -->
                    <div class="mb-6 flex justify-between items-center no-print">
                        <div class="flex gap-2">
                            <button id="tab-insights" onclick="switchTab('insights')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-lightbulb mr-2"></i>Insights
                            </button>
                            <button id="tab-relationships" onclick="switchTab('relationships')" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                                <i class="fas fa-project-diagram mr-2"></i>Relationships
                            </button>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="window.print()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                                <i class="fas fa-file-pdf"></i>
                                Export to PDF
                            </button>
                            <button onclick="showSection('upload')" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center gap-2">
                                <i class="fas fa-plus"></i>
                                New Analysis
                            </button>
                        </div>
                    </div>

                    <!-- Dataset Info -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                            Dataset Overview
                        </h2>
                        <div id="dataset-info" class="grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                    </div>

                    <!-- Insights Tab Content -->
                    <div id="tab-content-insights">

                    <!-- Visualizations -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-line mr-2 text-purple-600"></i>
                            Visual Insights
                        </h2>
                        <div id="visualizations-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    </div>

                    <!-- Key Insights -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                            Key Insights
                        </h2>
                        <div id="insights-container" class="space-y-4"></div>
                    </div>

                    <!-- Sample Data -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-table mr-2 text-green-600"></i>
                            Sample Data
                        </h2>
                        <div id="sample-data" class="overflow-x-auto"></div>
                    </div>
                    </div>

                    <!-- Relationships Tab Content -->
                    <div id="tab-content-relationships" class="hidden">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                                <i class="fas fa-project-diagram mr-2 text-purple-600"></i>
                                Interactive Relationship Graph
                            </h2>
                            <p class="text-gray-600 mb-4">
                                This graph shows how columns relate to each other. Thicker lines mean stronger relationships.
                                Blue circles are columns, green circles are common values.
                            </p>
                            <div id="graph-container" class="bg-gray-50 rounded-lg p-4" style="height: 600px; position: relative;">
                                <svg id="relationship-graph" width="100%" height="100%"></svg>
                            </div>
                            <div id="graph-legend" class="mt-4 grid grid-cols-3 gap-4 text-sm">
                                <div><span class="inline-block w-4 h-4 bg-blue-500 rounded-full mr-2"></span>Column</div>
                                <div><span class="inline-block w-4 h-4 bg-green-500 rounded-full mr-2"></span>Value</div>
                                <div><span class="inline-block w-3 h-3 border-2 border-purple-500 mr-2"></span>Correlation</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Datasets List -->
                <div id="datasets-section" class="hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-database mr-2 text-blue-600"></i>
                                Your Datasets
                            </h2>
                            <button id="back-to-upload" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-plus mr-2"></i>New Upload
                            </button>
                        </div>
                        <div id="datasets-list"></div>
                    </div>
                </div>
            </main>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
        <script src="/static/app.js"><\/script>
        <script src="/static/graph.js"><\/script>
    </body>
    </html>
  `));const Ht=new tt,Mn=Object.assign({"/src/index.tsx":Se});let br=!1;for(const[,e]of Object.entries(Mn))e&&(Ht.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Ht.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),br=!0);if(!br)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Ht as default};
