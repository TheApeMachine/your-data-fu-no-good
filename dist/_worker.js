var jt=Object.defineProperty;var ze=e=>{throw TypeError(e)};var _t=(e,t,r)=>t in e?jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var m=(e,t,r)=>_t(e,typeof t!="symbol"?t+"":t,r),Pe=(e,t,r)=>t.has(e)||ze("Cannot "+r);var u=(e,t,r)=>(Pe(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>t.has(e)?ze("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),p=(e,t,r,n)=>(Pe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),y=(e,t,r)=>(Pe(e,t,"access private method"),r);var Ue=(e,t,r,n)=>({set _(a){p(e,t,a,r)},get _(){return u(e,t,n)}});var ke=(e,t,r)=>(n,a)=>{let s=-1;return i(0);async function i(l){if(l<=s)throw new Error("next() called multiple times");s=l;let o,c=!1,d;if(e[l]?(d=e[l][0][0],n.req.routeIndex=l):d=l===e.length&&a||void 0,d)try{o=await d(n,()=>i(l+1))}catch(h){if(h instanceof Error&&t)n.error=h,o=await t(h,n),c=!0;else throw h}else n.finalized===!1&&r&&(o=await r(n));return o&&(n.finalized===!1||c)&&(n.res=o),n}},At=Symbol(),$t=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,s=(e instanceof ut?e.raw.headers:e.headers).get("Content-Type");return s!=null&&s.startsWith("multipart/form-data")||s!=null&&s.startsWith("application/x-www-form-urlencoded")?Dt(e,{all:r,dot:n}):{}};async function Dt(e,t){const r=await e.formData();return r?Pt(r,t):{}}function Pt(e,t){const r=Object.create(null);return e.forEach((n,a)=>{t.all||a.endsWith("[]")?Mt(r,a,n):r[a]=n}),t.dot&&Object.entries(r).forEach(([n,a])=>{n.includes(".")&&(It(r,n,a),delete r[n])}),r}var Mt=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},It=(e,t,r)=>{let n=e;const a=t.split(".");a.forEach((s,i)=>{i===a.length-1?n[s]=r:((!n[s]||typeof n[s]!="object"||Array.isArray(n[s])||n[s]instanceof File)&&(n[s]=Object.create(null)),n=n[s])})},at=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Ht=e=>{const{groups:t,path:r}=Ft(e),n=at(r);return Lt(n,t)},Ft=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const a=`@${n}`;return t.push([a,r]),a}),{groups:t,path:e}},Lt=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let a=e.length-1;a>=0;a--)if(e[a].includes(n)){e[a]=e[a].replace(n,t[r][1]);break}}return e},Oe={},qt=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return Oe[n]||(r[2]?Oe[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Oe[n]=[e,r[1],!0]),Oe[n]}return null},Le=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},zt=e=>Le(e,decodeURI),it=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const a=t.charCodeAt(n);if(a===37){const s=t.indexOf("?",n),i=t.slice(r,s===-1?void 0:s);return zt(i.includes("%25")?i.replace(/%25/g,"%2525"):i)}else if(a===63)break}return t.slice(r,n)},Ut=e=>{const t=it(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ne=(e,t,...r)=>(r.length&&(t=ne(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),ot=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(a=>{if(a!==""&&!/\:/.test(a))n+="/"+a;else if(/\:/.test(a))if(/\?/.test(a)){r.length===0&&n===""?r.push("/"):r.push(n);const s=a.replace("?","");n+="/"+s,r.push(n)}else n+="/"+a}),r.filter((a,s,i)=>i.indexOf(a)===s)},Me=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Le(e,ct):e):e,lt=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let i=e.indexOf(`?${t}`,8);for(i===-1&&(i=e.indexOf(`&${t}`,8));i!==-1;){const l=e.charCodeAt(i+t.length+1);if(l===61){const o=i+t.length+2,c=e.indexOf("&",o);return Me(e.slice(o,c===-1?void 0:c))}else if(l==38||isNaN(l))return"";i=e.indexOf(`&${t}`,i+1)}if(n=/[%+]/.test(e),!n)return}const a={};n??(n=/[%+]/.test(e));let s=e.indexOf("?",8);for(;s!==-1;){const i=e.indexOf("&",s+1);let l=e.indexOf("=",s);l>i&&i!==-1&&(l=-1);let o=e.slice(s+1,l===-1?i===-1?void 0:i:l);if(n&&(o=Me(o)),s=i,o==="")continue;let c;l===-1?c="":(c=e.slice(l+1,i===-1?void 0:i),n&&(c=Me(c))),r?(a[o]&&Array.isArray(a[o])||(a[o]=[]),a[o].push(c)):a[o]??(a[o]=c)}return t?a[t]:a},kt=lt,Bt=(e,t)=>lt(e,t,!0),ct=decodeURIComponent,Be=e=>Le(e,ct),ie,T,F,dt,ht,He,q,Ge,ut=(Ge=class{constructor(e,t="/",r=[[]]){g(this,F);m(this,"raw");g(this,ie);g(this,T);m(this,"routeIndex",0);m(this,"path");m(this,"bodyCache",{});g(this,q,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const a=Object.keys(t)[0];return a?t[a].then(s=>(a==="json"&&(s=JSON.stringify(s)),new Response(s)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,p(this,T,r),p(this,ie,{})}param(e){return e?y(this,F,dt).call(this,e):y(this,F,ht).call(this)}query(e){return kt(this.url,e)}queries(e){return Bt(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await $t(this,e))}json(){return u(this,q).call(this,"text").then(e=>JSON.parse(e))}text(){return u(this,q).call(this,"text")}arrayBuffer(){return u(this,q).call(this,"arrayBuffer")}blob(){return u(this,q).call(this,"blob")}formData(){return u(this,q).call(this,"formData")}addValidatedData(e,t){u(this,ie)[e]=t}valid(e){return u(this,ie)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[At](){return u(this,T)}get matchedRoutes(){return u(this,T)[0].map(([[,e]])=>e)}get routePath(){return u(this,T)[0].map(([[,e]])=>e)[this.routeIndex].path}},ie=new WeakMap,T=new WeakMap,F=new WeakSet,dt=function(e){const t=u(this,T)[0][this.routeIndex][1][e],r=y(this,F,He).call(this,t);return r&&/\%/.test(r)?Be(r):r},ht=function(){const e={},t=Object.keys(u(this,T)[0][this.routeIndex][1]);for(const r of t){const n=y(this,F,He).call(this,u(this,T)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?Be(n):n)}return e},He=function(e){return u(this,T)[1]?u(this,T)[1][e]:e},q=new WeakMap,Ge),Vt={Stringify:1},ft=async(e,t,r,n,a)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const s=e.callbacks;return s!=null&&s.length?(a?a[0]+=e:a=[e],Promise.all(s.map(l=>l({phase:t,buffer:a,context:n}))).then(l=>Promise.all(l.filter(Boolean).map(o=>ft(o,t,!1,n,a))).then(()=>a[0]))):Promise.resolve(e)},Wt="text/plain; charset=UTF-8",Ie=(e,t)=>({"Content-Type":e,...t}),xe,be,P,oe,M,C,ve,le,ce,G,we,Ee,z,se,Xe,Jt=(Xe=class{constructor(e,t){g(this,z);g(this,xe);g(this,be);m(this,"env",{});g(this,P);m(this,"finalized",!1);m(this,"error");g(this,oe);g(this,M);g(this,C);g(this,ve);g(this,le);g(this,ce);g(this,G);g(this,we);g(this,Ee);m(this,"render",(...e)=>(u(this,le)??p(this,le,t=>this.html(t)),u(this,le).call(this,...e)));m(this,"setLayout",e=>p(this,ve,e));m(this,"getLayout",()=>u(this,ve));m(this,"setRenderer",e=>{p(this,le,e)});m(this,"header",(e,t,r)=>{this.finalized&&p(this,C,new Response(u(this,C).body,u(this,C)));const n=u(this,C)?u(this,C).headers:u(this,G)??p(this,G,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});m(this,"status",e=>{p(this,oe,e)});m(this,"set",(e,t)=>{u(this,P)??p(this,P,new Map),u(this,P).set(e,t)});m(this,"get",e=>u(this,P)?u(this,P).get(e):void 0);m(this,"newResponse",(...e)=>y(this,z,se).call(this,...e));m(this,"body",(e,t,r)=>y(this,z,se).call(this,e,t,r));m(this,"text",(e,t,r)=>!u(this,G)&&!u(this,oe)&&!t&&!r&&!this.finalized?new Response(e):y(this,z,se).call(this,e,t,Ie(Wt,r)));m(this,"json",(e,t,r)=>y(this,z,se).call(this,JSON.stringify(e),t,Ie("application/json",r)));m(this,"html",(e,t,r)=>{const n=a=>y(this,z,se).call(this,a,t,Ie("text/html; charset=UTF-8",r));return typeof e=="object"?ft(e,Vt.Stringify,!1,{}).then(n):n(e)});m(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});m(this,"notFound",()=>(u(this,ce)??p(this,ce,()=>new Response),u(this,ce).call(this,this)));p(this,xe,e),t&&(p(this,M,t.executionCtx),this.env=t.env,p(this,ce,t.notFoundHandler),p(this,Ee,t.path),p(this,we,t.matchResult))}get req(){return u(this,be)??p(this,be,new ut(u(this,xe),u(this,Ee),u(this,we))),u(this,be)}get event(){if(u(this,M)&&"respondWith"in u(this,M))return u(this,M);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,M))return u(this,M);throw Error("This context has no ExecutionContext")}get res(){return u(this,C)||p(this,C,new Response(null,{headers:u(this,G)??p(this,G,new Headers)}))}set res(e){if(u(this,C)&&e){e=new Response(e.body,e);for(const[t,r]of u(this,C).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=u(this,C).headers.getSetCookie();e.headers.delete("set-cookie");for(const a of n)e.headers.append("set-cookie",a)}else e.headers.set(t,r)}p(this,C,e),this.finalized=!0}get var(){return u(this,P)?Object.fromEntries(u(this,P)):{}}},xe=new WeakMap,be=new WeakMap,P=new WeakMap,oe=new WeakMap,M=new WeakMap,C=new WeakMap,ve=new WeakMap,le=new WeakMap,ce=new WeakMap,G=new WeakMap,we=new WeakMap,Ee=new WeakMap,z=new WeakSet,se=function(e,t,r){const n=u(this,C)?new Headers(u(this,C).headers):u(this,G)??new Headers;if(typeof t=="object"&&"headers"in t){const s=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[i,l]of s)i.toLowerCase()==="set-cookie"?n.append(i,l):n.set(i,l)}if(r)for(const[s,i]of Object.entries(r))if(typeof i=="string")n.set(s,i);else{n.delete(s);for(const l of i)n.append(s,l)}const a=typeof t=="number"?t:(t==null?void 0:t.status)??u(this,oe);return new Response(e,{status:a,headers:n})},Xe),w="ALL",Kt="all",Yt=["get","post","put","delete","options","patch"],pt="Can not add a route since the matcher is already built.",mt=class extends Error{},Gt="__COMPOSED_HANDLER",Xt=e=>e.text("404 Not Found",404),Ve=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},j,E,yt,_,K,Ce,Ne,Qe,gt=(Qe=class{constructor(t={}){g(this,E);m(this,"get");m(this,"post");m(this,"put");m(this,"delete");m(this,"options");m(this,"patch");m(this,"all");m(this,"on");m(this,"use");m(this,"router");m(this,"getPath");m(this,"_basePath","/");g(this,j,"/");m(this,"routes",[]);g(this,_,Xt);m(this,"errorHandler",Ve);m(this,"onError",t=>(this.errorHandler=t,this));m(this,"notFound",t=>(p(this,_,t),this));m(this,"fetch",(t,...r)=>y(this,E,Ne).call(this,t,r[1],r[0],t.method));m(this,"request",(t,r,n,a)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,a):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${ne("/",t)}`,r),n,a)));m(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(y(this,E,Ne).call(this,t.request,t,void 0,t.request.method))})});[...Yt,Kt].forEach(s=>{this[s]=(i,...l)=>(typeof i=="string"?p(this,j,i):y(this,E,K).call(this,s,u(this,j),i),l.forEach(o=>{y(this,E,K).call(this,s,u(this,j),o)}),this)}),this.on=(s,i,...l)=>{for(const o of[i].flat()){p(this,j,o);for(const c of[s].flat())l.map(d=>{y(this,E,K).call(this,c.toUpperCase(),u(this,j),d)})}return this},this.use=(s,...i)=>(typeof s=="string"?p(this,j,s):(p(this,j,"*"),i.unshift(s)),i.forEach(l=>{y(this,E,K).call(this,w,u(this,j),l)}),this);const{strict:n,...a}=t;Object.assign(this,a),this.getPath=n??!0?t.getPath??it:Ut}route(t,r){const n=this.basePath(t);return r.routes.map(a=>{var i;let s;r.errorHandler===Ve?s=a.handler:(s=async(l,o)=>(await ke([],r.errorHandler)(l,()=>a.handler(l,o))).res,s[Gt]=a.handler),y(i=n,E,K).call(i,a.method,a.path,s)}),this}basePath(t){const r=y(this,E,yt).call(this);return r._basePath=ne(this._basePath,t),r}mount(t,r,n){let a,s;n&&(typeof n=="function"?s=n:(s=n.optionHandler,n.replaceRequest===!1?a=o=>o:a=n.replaceRequest));const i=s?o=>{const c=s(o);return Array.isArray(c)?c:[c]}:o=>{let c;try{c=o.executionCtx}catch{}return[o.env,c]};a||(a=(()=>{const o=ne(this._basePath,t),c=o==="/"?0:o.length;return d=>{const h=new URL(d.url);return h.pathname=h.pathname.slice(c)||"/",new Request(h,d)}})());const l=async(o,c)=>{const d=await r(a(o.req.raw),...i(o));if(d)return d;await c()};return y(this,E,K).call(this,w,ne(t,"*"),l),this}},j=new WeakMap,E=new WeakSet,yt=function(){const t=new gt({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,p(t,_,u(this,_)),t.routes=this.routes,t},_=new WeakMap,K=function(t,r,n){t=t.toUpperCase(),r=ne(this._basePath,r);const a={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,a]),this.routes.push(a)},Ce=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ne=function(t,r,n,a){if(a==="HEAD")return(async()=>new Response(null,await y(this,E,Ne).call(this,t,r,n,"GET")))();const s=this.getPath(t,{env:n}),i=this.router.match(a,s),l=new Jt(t,{path:s,matchResult:i,env:n,executionCtx:r,notFoundHandler:u(this,_)});if(i[0].length===1){let c;try{c=i[0][0][0][0](l,async()=>{l.res=await u(this,_).call(this,l)})}catch(d){return y(this,E,Ce).call(this,d,l)}return c instanceof Promise?c.then(d=>d||(l.finalized?l.res:u(this,_).call(this,l))).catch(d=>y(this,E,Ce).call(this,d,l)):c??u(this,_).call(this,l)}const o=ke(i[0],this.errorHandler,u(this,_));return(async()=>{try{const c=await o(l);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return y(this,E,Ce).call(this,c,l)}})()},Qe),xt=[];function Qt(e,t){const r=this.buildAllMatchers(),n=(a,s)=>{const i=r[a]||r[w],l=i[2][s];if(l)return l;const o=s.match(i[0]);if(!o)return[[],xt];const c=o.indexOf("",1);return[i[1][c],o]};return this.match=n,n(e,t)}var je="[^/]+",me=".*",ge="(?:|/.*)",ae=Symbol(),Zt=new Set(".\\+*[^]$()");function er(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===me||e===ge?1:t===me||t===ge?-1:e===je?1:t===je?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var X,Q,A,Ze,Fe=(Ze=class{constructor(){g(this,X);g(this,Q);g(this,A,Object.create(null))}insert(t,r,n,a,s){if(t.length===0){if(u(this,X)!==void 0)throw ae;if(s)return;p(this,X,r);return}const[i,...l]=t,o=i==="*"?l.length===0?["","",me]:["","",je]:i==="/*"?["","",ge]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(o){const d=o[1];let h=o[2]||je;if(d&&o[2]&&(h===".*"||(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))))throw ae;if(c=u(this,A)[h],!c){if(Object.keys(u(this,A)).some(f=>f!==me&&f!==ge))throw ae;if(s)return;c=u(this,A)[h]=new Fe,d!==""&&p(c,Q,a.varIndex++)}!s&&d!==""&&n.push([d,u(c,Q)])}else if(c=u(this,A)[i],!c){if(Object.keys(u(this,A)).some(d=>d.length>1&&d!==me&&d!==ge))throw ae;if(s)return;c=u(this,A)[i]=new Fe}c.insert(l,r,n,a,s)}buildRegExpStr(){const r=Object.keys(u(this,A)).sort(er).map(n=>{const a=u(this,A)[n];return(typeof u(a,Q)=="number"?`(${n})@${u(a,Q)}`:Zt.has(n)?`\\${n}`:n)+a.buildRegExpStr()});return typeof u(this,X)=="number"&&r.unshift(`#${u(this,X)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},X=new WeakMap,Q=new WeakMap,A=new WeakMap,Ze),_e,Re,et,tr=(et=class{constructor(){g(this,_e,{varIndex:0});g(this,Re,new Fe)}insert(e,t,r){const n=[],a=[];for(let i=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const c=`@\\${i}`;return a[i]=[c,o],i++,l=!0,c}),!l)break}const s=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let i=a.length-1;i>=0;i--){const[l]=a[i];for(let o=s.length-1;o>=0;o--)if(s[o].indexOf(l)!==-1){s[o]=s[o].replace(l,a[i][1]);break}}return u(this,Re).insert(s,t,n,u(this,_e),r),n}buildRegExp(){let e=u(this,Re).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(a,s,i)=>s!==void 0?(r[++t]=Number(s),"$()"):(i!==void 0&&(n[Number(i)]=++t),"")),[new RegExp(`^${e}`),r,n]}},_e=new WeakMap,Re=new WeakMap,et),rr=[/^$/,[],Object.create(null)],Te=Object.create(null);function bt(e){return Te[e]??(Te[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function nr(){Te=Object.create(null)}function sr(e){var c;const t=new tr,r=[];if(e.length===0)return rr;const n=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,h],[f,x])=>d?1:f?-1:h.length-x.length),a=Object.create(null);for(let d=0,h=-1,f=n.length;d<f;d++){const[x,N,b]=n[d];x?a[N]=[b.map(([O])=>[O,Object.create(null)]),xt]:h++;let v;try{v=t.insert(N,h,x)}catch(O){throw O===ae?new mt(N):O}x||(r[h]=b.map(([O,te])=>{const he=Object.create(null);for(te-=1;te>=0;te--){const[$,$e]=v[te];he[$]=$e}return[O,he]}))}const[s,i,l]=t.buildRegExp();for(let d=0,h=r.length;d<h;d++)for(let f=0,x=r[d].length;f<x;f++){const N=(c=r[d][f])==null?void 0:c[1];if(!N)continue;const b=Object.keys(N);for(let v=0,O=b.length;v<O;v++)N[b[v]]=l[N[b[v]]]}const o=[];for(const d in i)o[d]=r[i[d]];return[s,o,a]}function re(e,t){if(e){for(const r of Object.keys(e).sort((n,a)=>a.length-n.length))if(bt(r).test(t))return[...e[r]]}}var U,k,Ae,vt,tt,ar=(tt=class{constructor(){g(this,Ae);m(this,"name","RegExpRouter");g(this,U);g(this,k);m(this,"match",Qt);p(this,U,{[w]:Object.create(null)}),p(this,k,{[w]:Object.create(null)})}add(e,t,r){var l;const n=u(this,U),a=u(this,k);if(!n||!a)throw new Error(pt);n[e]||[n,a].forEach(o=>{o[e]=Object.create(null),Object.keys(o[w]).forEach(c=>{o[e][c]=[...o[w][c]]})}),t==="/*"&&(t="*");const s=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=bt(t);e===w?Object.keys(n).forEach(c=>{var d;(d=n[c])[t]||(d[t]=re(n[c],t)||re(n[w],t)||[])}):(l=n[e])[t]||(l[t]=re(n[e],t)||re(n[w],t)||[]),Object.keys(n).forEach(c=>{(e===w||e===c)&&Object.keys(n[c]).forEach(d=>{o.test(d)&&n[c][d].push([r,s])})}),Object.keys(a).forEach(c=>{(e===w||e===c)&&Object.keys(a[c]).forEach(d=>o.test(d)&&a[c][d].push([r,s]))});return}const i=ot(t)||[t];for(let o=0,c=i.length;o<c;o++){const d=i[o];Object.keys(a).forEach(h=>{var f;(e===w||e===h)&&((f=a[h])[d]||(f[d]=[...re(n[h],d)||re(n[w],d)||[]]),a[h][d].push([r,s-c+o+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(u(this,k)).concat(Object.keys(u(this,U))).forEach(t=>{e[t]||(e[t]=y(this,Ae,vt).call(this,t))}),p(this,U,p(this,k,void 0)),nr(),e}},U=new WeakMap,k=new WeakMap,Ae=new WeakSet,vt=function(e){const t=[];let r=e===w;return[u(this,U),u(this,k)].forEach(n=>{const a=n[e]?Object.keys(n[e]).map(s=>[s,n[e][s]]):[];a.length!==0?(r||(r=!0),t.push(...a)):e!==w&&t.push(...Object.keys(n[w]).map(s=>[s,n[w][s]]))}),r?sr(t):null},tt),B,I,rt,ir=(rt=class{constructor(e){m(this,"name","SmartRouter");g(this,B,[]);g(this,I,[]);p(this,B,e.routers)}add(e,t,r){if(!u(this,I))throw new Error(pt);u(this,I).push([e,t,r])}match(e,t){if(!u(this,I))throw new Error("Fatal error");const r=u(this,B),n=u(this,I),a=r.length;let s=0,i;for(;s<a;s++){const l=r[s];try{for(let o=0,c=n.length;o<c;o++)l.add(...n[o]);i=l.match(e,t)}catch(o){if(o instanceof mt)continue;throw o}this.match=l.match.bind(l),p(this,B,[l]),p(this,I,void 0);break}if(s===a)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,i}get activeRouter(){if(u(this,I)||u(this,B).length!==1)throw new Error("No active router has been determined yet.");return u(this,B)[0]}},B=new WeakMap,I=new WeakMap,rt),pe=Object.create(null),V,S,Z,ue,R,H,Y,nt,wt=(nt=class{constructor(e,t,r){g(this,H);g(this,V);g(this,S);g(this,Z);g(this,ue,0);g(this,R,pe);if(p(this,S,r||Object.create(null)),p(this,V,[]),e&&t){const n=Object.create(null);n[e]={handler:t,possibleKeys:[],score:0},p(this,V,[n])}p(this,Z,[])}insert(e,t,r){p(this,ue,++Ue(this,ue)._);let n=this;const a=Ht(t),s=[];for(let i=0,l=a.length;i<l;i++){const o=a[i],c=a[i+1],d=qt(o,c),h=Array.isArray(d)?d[0]:o;if(h in u(n,S)){n=u(n,S)[h],d&&s.push(d[1]);continue}u(n,S)[h]=new wt,d&&(u(n,Z).push(d),s.push(d[1])),n=u(n,S)[h]}return u(n,V).push({[e]:{handler:r,possibleKeys:s.filter((i,l,o)=>o.indexOf(i)===l),score:u(this,ue)}}),n}search(e,t){var l;const r=[];p(this,R,pe);let a=[this];const s=at(t),i=[];for(let o=0,c=s.length;o<c;o++){const d=s[o],h=o===c-1,f=[];for(let x=0,N=a.length;x<N;x++){const b=a[x],v=u(b,S)[d];v&&(p(v,R,u(b,R)),h?(u(v,S)["*"]&&r.push(...y(this,H,Y).call(this,u(v,S)["*"],e,u(b,R))),r.push(...y(this,H,Y).call(this,v,e,u(b,R)))):f.push(v));for(let O=0,te=u(b,Z).length;O<te;O++){const he=u(b,Z)[O],$=u(b,R)===pe?{}:{...u(b,R)};if(he==="*"){const L=u(b,S)["*"];L&&(r.push(...y(this,H,Y).call(this,L,e,u(b,R))),p(L,R,$),f.push(L));continue}const[$e,qe,fe]=he;if(!d&&!(fe instanceof RegExp))continue;const D=u(b,S)[$e],Tt=s.slice(o).join("/");if(fe instanceof RegExp){const L=fe.exec(Tt);if(L){if($[qe]=L[0],r.push(...y(this,H,Y).call(this,D,e,u(b,R),$)),Object.keys(u(D,S)).length){p(D,R,$);const De=((l=L[0].match(/\//))==null?void 0:l.length)??0;(i[De]||(i[De]=[])).push(D)}continue}}(fe===!0||fe.test(d))&&($[qe]=d,h?(r.push(...y(this,H,Y).call(this,D,e,$,u(b,R))),u(D,S)["*"]&&r.push(...y(this,H,Y).call(this,u(D,S)["*"],e,$,u(b,R)))):(p(D,R,$),f.push(D)))}}a=f.concat(i.shift()??[])}return r.length>1&&r.sort((o,c)=>o.score-c.score),[r.map(({handler:o,params:c})=>[o,c])]}},V=new WeakMap,S=new WeakMap,Z=new WeakMap,ue=new WeakMap,R=new WeakMap,H=new WeakSet,Y=function(e,t,r,n){const a=[];for(let s=0,i=u(e,V).length;s<i;s++){const l=u(e,V)[s],o=l[t]||l[w],c={};if(o!==void 0&&(o.params=Object.create(null),a.push(o),r!==pe||n&&n!==pe))for(let d=0,h=o.possibleKeys.length;d<h;d++){const f=o.possibleKeys[d],x=c[o.score];o.params[f]=n!=null&&n[f]&&!x?n[f]:r[f]??(n==null?void 0:n[f]),c[o.score]=!0}}return a},nt),ee,st,or=(st=class{constructor(){m(this,"name","TrieRouter");g(this,ee);p(this,ee,new wt)}add(e,t,r){const n=ot(t);if(n){for(let a=0,s=n.length;a<s;a++)u(this,ee).insert(e,n[a],r);return}u(this,ee).insert(e,t,r)}match(e,t){return u(this,ee).search(e,t)}},ee=new WeakMap,st),Se=class extends gt{constructor(e={}){super(e),this.router=e.router??new ir({routers:[new ar,new or]})}},lr=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(s=>typeof s=="string"?s==="*"?()=>s:i=>s===i?i:null:typeof s=="function"?s:i=>s.includes(i)?i:null)(r.origin),a=(s=>typeof s=="function"?s:Array.isArray(s)?()=>s:()=>[])(r.allowMethods);return async function(i,l){var d;function o(h,f){i.res.headers.set(h,f)}const c=await n(i.req.header("origin")||"",i);if(c&&o("Access-Control-Allow-Origin",c),r.origin!=="*"){const h=i.req.header("Vary");h?o("Vary",h):o("Vary","Origin")}if(r.credentials&&o("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&o("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),i.req.method==="OPTIONS"){r.maxAge!=null&&o("Access-Control-Max-Age",r.maxAge.toString());const h=await a(i.req.header("origin")||"",i);h.length&&o("Access-Control-Allow-Methods",h.join(","));let f=r.allowHeaders;if(!(f!=null&&f.length)){const x=i.req.header("Access-Control-Request-Headers");x&&(f=x.split(/\s*,\s*/))}return f!=null&&f.length&&(o("Access-Control-Allow-Headers",f.join(",")),i.res.headers.append("Vary","Access-Control-Request-Headers")),i.res.headers.delete("Content-Length"),i.res.headers.delete("Content-Type"),new Response(null,{headers:i.res.headers,status:204,statusText:"No Content"})}await l()}},cr=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,We=(e,t=dr)=>{const r=/\.([a-zA-Z0-9]+?)$/,n=e.match(r);if(!n)return;let a=t[n[1]];return a&&a.startsWith("text")&&(a+="; charset=utf-8"),a},ur={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},dr=ur,hr=(...e)=>{let t=e.filter(a=>a!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),n=[];for(const a of r)a===".."&&n.length>0&&n.at(-1)!==".."?n.pop():a!=="."&&n.push(a);return n.join("/")||"."},Et={br:".br",zstd:".zst",gzip:".gz"},fr=Object.keys(Et),pr="index.html",mr=e=>{const t=e.root??"./",r=e.path,n=e.join??hr;return async(a,s)=>{var d,h,f,x;if(a.finalized)return s();let i;if(e.path)i=e.path;else try{if(i=decodeURIComponent(a.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(i))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,a.req.path,a)),s()}let l=n(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(i):i);e.isDir&&await e.isDir(l)&&(l=n(l,pr));const o=e.getContent;let c=await o(l,a);if(c instanceof Response)return a.newResponse(c.body,c);if(c){const N=e.mimes&&We(l,e.mimes)||We(l);if(a.header("Content-Type",N||"application/octet-stream"),e.precompressed&&(!N||cr.test(N))){const b=new Set((h=a.req.header("Accept-Encoding"))==null?void 0:h.split(",").map(v=>v.trim()));for(const v of fr){if(!b.has(v))continue;const O=await o(l+Et[v],a);if(O){c=O,a.header("Content-Encoding",v),a.header("Vary","Accept-Encoding",{append:!0});break}}}return await((f=e.onFound)==null?void 0:f.call(e,l,a)),a.body(c)}await((x=e.onNotFound)==null?void 0:x.call(e,l,a)),await s()}},gr=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let n;t&&t.namespace?n=t.namespace:n=__STATIC_CONTENT;const a=r[e]||e;if(!a)return null;const s=await n.get(a,{type:"stream"});return s||null},yr=e=>async function(r,n){return mr({...e,getContent:async s=>gr(s,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,n)},xr=e=>yr(e);function br(e){const t=e.trim().split(`
`);if(t.length===0)throw new Error("Empty CSV file");const r=Je(t[0]),n=[];for(let a=1;a<t.length;a++){if(!t[a].trim())continue;const s=Je(t[a]);s.length!==r.length&&console.warn(`Row ${a} has ${s.length} columns, expected ${r.length}`);const i={};r.forEach((l,o)=>{i[l]=s[o]!==void 0?s[o]:null}),n.push(i)}return n}function Je(e){const t=[];let r="",n=!1;for(let a=0;a<e.length;a++){const s=e[a],i=e[a+1];s==='"'?n&&i==='"'?(r+='"',a++):n=!n:s===","&&!n?(t.push(r.trim()),r=""):r+=s}return t.push(r.trim()),t}function vr(e){if(e.length===0)return{};const t=Object.keys(e[0]),r={};for(const n of t){const a=e.slice(0,Math.min(100,e.length)).map(s=>s[n]);r[n]=wr(a)}return r}function wr(e){const t=e.filter(s=>s!=null&&s!=="");return t.length===0?"string":t.filter(s=>!isNaN(Number(s))).length===t.length?"number":t.filter(s=>!isNaN(Date.parse(s))).length===t.length?"date":t.filter(s=>s.toString().toLowerCase()==="true"||s.toString().toLowerCase()==="false").length===t.length?"boolean":"string"}function Er(e,t){const r=e.filter(s=>s!=null&&s!==""),n=e.length-r.length,a=new Set(r).size;if(t==="number"){const s=r.map(i=>Number(i)).filter(i=>!isNaN(i));return{count:e.length,mean:W(s),median:Rr(s),mode:Ke(s),stdDev:Sr(s),min:Math.min(...s),max:Math.max(...s),q1:ye(s,25),q2:ye(s,50),q3:ye(s,75),nullCount:n,uniqueCount:a}}return{count:e.length,mode:Ke(r),min:r[0],max:r[r.length-1],nullCount:n,uniqueCount:a}}function W(e){return e.length===0?0:e.reduce((t,r)=>t+r,0)/e.length}function Rr(e){if(e.length===0)return 0;const t=[...e].sort((n,a)=>n-a),r=Math.floor(t.length/2);return t.length%2===0?(t[r-1]+t[r])/2:t[r]}function Ke(e){if(e.length===0)return null;const t={};let r=0,n=null;for(const a of e){const s=String(a);t[s]=(t[s]||0)+1,t[s]>r&&(r=t[s],n=a)}return n}function Sr(e){if(e.length===0)return 0;const t=W(e),r=e.map(n=>Math.pow(n-t,2));return Math.sqrt(W(r))}function ye(e,t){if(e.length===0)return 0;const r=[...e].sort((l,o)=>l-o),n=t/100*(r.length-1),a=Math.floor(n),s=Math.ceil(n),i=n%1;return a===s?r[a]:r[a]*(1-i)+r[s]*i}function Or(e){if(e.length<4)return{indices:[],threshold:0};const t=ye(e,25),r=ye(e,75),n=r-t,a=t-1.5*n,s=r+1.5*n,i=[];return e.forEach((l,o)=>{(l<a||l>s)&&i.push(o)}),{indices:i,threshold:n}}function Cr(e,t){if(e.length!==t.length||e.length===0)return 0;const r=e.length,n=W(e),a=W(t);let s=0,i=0,l=0;for(let o=0;o<r;o++){const c=e[o]-n,d=t[o]-a;s+=c*d,i+=c*c,l+=d*d}return i===0||l===0?0:s/Math.sqrt(i*l)}function Nr(e){if(e.length<2)return{direction:"stable",strength:0};const t=e.length,r=Array.from({length:t},(c,d)=>d),n=W(r),a=W(e);let s=0,i=0;for(let c=0;c<t;c++)s+=(r[c]-n)*(e[c]-a),i+=Math.pow(r[c]-n,2);const l=i===0?0:s/i,o=Math.min(Math.abs(l)/(W(e)||1),1);return Math.abs(l)<.01?{direction:"stable",strength:0}:{direction:l>0?"up":"down",strength:o}}async function Rt(e,t,r,n){console.log(`Starting analysis for dataset ${e}`);for(const s of r){const i=t.map(d=>d[s.name]),l=Er(i,s.type),o=Tr(s.name,s.type,l),c=_r(l,s.type);if(await n.prepare(`
      INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(e,"statistics",s.name,JSON.stringify(l),1,o,c).run(),s.type==="number"){const d=i.map(f=>Number(f)).filter(f=>!isNaN(f)),h=Or(d);if(h.indices.length>0){const f=`Found ${h.indices.length} unusual values in "${s.name}" (${(h.indices.length/d.length*100).toFixed(1)}% of data). These values are significantly different from the rest and might need attention.`;await n.prepare(`
          INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance)
          VALUES (?, ?, ?, ?, ?, ?, ?)
        `).bind(e,"outlier",s.name,JSON.stringify({count:h.indices.length,indices:h.indices.slice(0,10)}),.85,f,h.indices.length>d.length*.05?"high":"medium").run()}if(d.length>5){const f=Nr(d);if(f.direction!=="stable"){const x=`"${s.name}" shows a ${f.direction==="up"?"rising":"falling"} trend with ${(f.strength*100).toFixed(0)}% strength. This ${f.direction==="up"?"increase":"decrease"} is consistent across the dataset.`;await n.prepare(`
            INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance)
            VALUES (?, ?, ?, ?, ?, ?, ?)
          `).bind(e,"trend",s.name,JSON.stringify(f),f.strength,x,f.strength>.5?"high":"medium").run()}}}}const a=r.filter(s=>s.type==="number");for(let s=0;s<a.length;s++)for(let i=s+1;i<a.length;i++){const l=a[s],o=a[i],c=t.map(h=>Number(h[l.name])).filter(h=>!isNaN(h)),d=t.map(h=>Number(h[o.name])).filter(h=>!isNaN(h));if(c.length>5&&d.length>5){const h=Cr(c,d);if(Math.abs(h)>.5){const f=jr(l.name,o.name,h);await n.prepare(`
            INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance)
            VALUES (?, ?, ?, ?, ?, ?, ?)
          `).bind(e,"correlation",`${l.name}_vs_${o.name}`,JSON.stringify({column1:l.name,column2:o.name,correlation:h}),Math.abs(h),f,Math.abs(h)>.7?"high":"medium").run()}}}for(const s of r)if(s.type==="string"){const i=t.map(d=>d[s.name]).filter(d=>d),l={};i.forEach(d=>{l[d]=(l[d]||0)+1});const c=Object.entries(l).sort((d,h)=>h[1]-d[1]).slice(0,5);if(c.length>0&&c[0][1]>i.length*.1){const d=`The most common value in "${s.name}" is "${c[0][0]}" appearing ${c[0][1]} times (${(c[0][1]/i.length*100).toFixed(1)}% of records).`;await n.prepare(`
          INSERT INTO analyses (dataset_id, analysis_type, column_name, result, confidence, explanation, importance)
          VALUES (?, ?, ?, ?, ?, ?, ?)
        `).bind(e,"pattern",s.name,JSON.stringify({topPatterns:c}),.9,d,"medium").run()}}console.log(`Analysis complete for dataset ${e}`)}function Tr(e,t,r){var n,a,s,i;return t==="number"?`"${e}" ranges from ${(n=r.min)==null?void 0:n.toFixed(2)} to ${(a=r.max)==null?void 0:a.toFixed(2)} with an average of ${(s=r.mean)==null?void 0:s.toFixed(2)}. About half the values are below ${(i=r.median)==null?void 0:i.toFixed(2)}.`:`"${e}" contains ${r.count} values with ${r.uniqueCount} unique entries. Most common: "${r.mode}".`}function jr(e,t,r){const n=Math.abs(r)>.7?"strong":"moderate";return r>0?`There's a ${n} relationship between "${e}" and "${t}": when ${e} increases, ${t} tends to increase too (correlation: ${r.toFixed(2)}).`:`There's a ${n} inverse relationship between "${e}" and "${t}": when ${e} increases, ${t} tends to decrease (correlation: ${r.toFixed(2)}).`}function _r(e,t){return e.nullCount>e.count*.5?"high":e.uniqueCount===1?"low":t==="number"&&e.stdDev>e.mean?"high":"medium"}async function St(e,t,r,n){console.log(`Generating visualizations for dataset ${e}`);let a=0;for(const s of r){const i=await Ar(s,t);i&&await n.prepare(`
        INSERT INTO visualizations (dataset_id, analysis_id, chart_type, title, config, explanation, display_order)
        VALUES (?, ?, ?, ?, ?, ?, ?)
      `).bind(e,s.id,i.chartType,i.title,JSON.stringify(i.config),i.explanation,a++).run()}console.log(`Generated ${a} visualizations`)}function Ar(e,t){switch(e.analysis_type){case"statistics":return $r(e,t);case"correlation":return Dr(e,t);case"outlier":return Pr(e,t);case"pattern":return Mr(e);case"trend":return Ir(e,t);default:return null}}function $r(e,t){const r=e.column_name;if(!r)return null;if(e.result.mean!==void 0){const l=t.map(c=>Number(c[r])).filter(c=>!isNaN(c)),o=Hr(l);return{chartType:"bar",title:`Distribution: ${r}`,explanation:`This histogram shows how values in "${r}" are distributed. Taller bars mean more data points at that value range.`,config:{type:"bar",data:{labels:o.labels,datasets:[{label:"Frequency",data:o.data,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`${r} Distribution`}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Count"}},x:{title:{display:!0,text:r}}}}}}}const a=t.map(l=>l[r]).filter(l=>l!=null),s={};a.forEach(l=>{s[String(l)]=(s[String(l)]||0)+1});const i=Object.entries(s).sort((l,o)=>o[1]-l[1]).slice(0,10);return{chartType:"bar",title:`Top Values: ${r}`,explanation:`This chart shows the most common values in "${r}". The tallest bar is the most frequent value.`,config:{type:"bar",data:{labels:i.map(([l])=>l),datasets:[{label:"Count",data:i.map(([,l])=>l),backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:`Most Common: ${r}`}},scales:{x:{beginAtZero:!0,title:{display:!0,text:"Count"}}}}}}}function Dr(e,t){const r=e.result,n=r.column1,a=r.column2;if(!n||!a)return null;const s=t.map(o=>({x:Number(o[n]),y:Number(o[a])})).filter(o=>!isNaN(o.x)&&!isNaN(o.y)),i=r.correlation,l=i>0?"rgba(139, 92, 246, 0.6)":"rgba(239, 68, 68, 0.6)";return{chartType:"scatter",title:`Relationship: ${n} vs ${a}`,explanation:`Each dot represents one record. ${i>0?"The upward pattern shows they move together.":"The downward pattern shows they move in opposite directions."}`,config:{type:"scatter",data:{datasets:[{label:`${n} vs ${a}`,data:s,backgroundColor:l,borderColor:l.replace("0.6","1"),borderWidth:1,pointRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Correlation: ${i.toFixed(2)}`}},scales:{x:{title:{display:!0,text:n}},y:{title:{display:!0,text:a}}}}}}}function Pr(e,t){const r=e.column_name;if(!r)return null;const n=new Set(e.result.indices||[]),a=t.map((l,o)=>({x:o,y:Number(l[r]),isOutlier:n.has(o)})).filter(l=>!isNaN(l.y)),s=a.filter(l=>!l.isOutlier),i=a.filter(l=>l.isOutlier);return{chartType:"scatter",title:`Outliers: ${r}`,explanation:"Red dots are unusual values that stand out from the pattern. Blue dots are normal values.",config:{type:"scatter",data:{datasets:[{label:"Normal",data:s,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,pointRadius:3},{label:"Outliers",data:i,backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:2,pointRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:`${r} - Outlier Detection`}},scales:{x:{title:{display:!0,text:"Record Index"}},y:{title:{display:!0,text:r}}}}}}}function Mr(e,t){const r=e.column_name;if(!r)return null;const n=e.result.topPatterns||[];if(n.length===0)return null;const a=n.slice(0,8);return{chartType:"pie",title:`Pattern Distribution: ${r}`,explanation:"Each slice shows what percentage of records have that value. Bigger slices are more common.",config:{type:"pie",data:{labels:a.map(([s])=>s),datasets:[{data:a.map(([,s])=>s),backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)","rgba(236, 72, 153, 0.8)","rgba(14, 165, 233, 0.8)","rgba(34, 197, 94, 0.8)"],borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"right"},title:{display:!0,text:`${r} Breakdown`}}}}}}function Ir(e,t){const r=e.column_name;if(!r)return null;const n=t.map(i=>Number(i[r])).filter(i=>!isNaN(i)),a=e.result,s=a.direction==="up"?"rgba(16, 185, 129, 0.6)":"rgba(239, 68, 68, 0.6)";return{chartType:"line",title:`Trend: ${r}`,explanation:`This line shows how "${r}" changes over time. ${a.direction==="up"?"The upward slope indicates growth.":"The downward slope indicates decline."}`,config:{type:"line",data:{labels:n.map((i,l)=>`#${l+1}`),datasets:[{label:r,data:n,backgroundColor:s,borderColor:s.replace("0.6","1"),borderWidth:2,fill:!1,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`${r} Over Time (${a.direction==="up"?"↗":"↘"} ${Math.round(a.strength*100)}% strength)`}},scales:{x:{title:{display:!0,text:"Record Number"}},y:{title:{display:!0,text:r}}}}}}}function Hr(e,t=10){if(e.length===0)return{labels:[],data:[]};const r=Math.min(...e),s=(Math.max(...e)-r)/t,i=new Array(t).fill(0),l=[];for(let o=0;o<t;o++){const c=r+o*s,d=r+(o+1)*s;l.push(`${c.toFixed(1)}-${d.toFixed(1)}`)}return e.forEach(o=>{let c=Math.floor((o-r)/s);c>=t&&(c=t-1),c<0&&(c=0),i[c]++}),{labels:l,data:i}}const Ot=new Se;Ot.post("/",async e=>{try{const r=(await e.req.formData()).get("file");if(!r)return e.json({error:"No file provided"},400);const n=r.name,a=n.endsWith(".csv")?"csv":n.endsWith(".json")?"json":null;if(!a)return e.json({error:"Unsupported file type. Please upload CSV or JSON."},400);const s=await r.text();let i;if(a==="csv")i=br(s);else try{const h=JSON.parse(s);i=Array.isArray(h)?h:[h]}catch{return e.json({error:"Invalid JSON format"},400)}if(i.length===0)return e.json({error:"File contains no data"},400);const l=vr(i),o=Object.keys(i[0]).map(h=>({name:h,type:l[h]||"string",nullable:i.some(f=>f[h]===null||f[h]===void 0||f[h]===""),unique_count:new Set(i.map(f=>f[h])).size,sample_values:i.slice(0,3).map(f=>f[h])})),d=(await e.env.DB.prepare(`
      INSERT INTO datasets (name, original_filename, file_type, row_count, column_count, columns, analysis_status)
      VALUES (?, ?, ?, ?, ?, ?, ?)
    `).bind(n.replace(/\.[^.]+$/,""),n,a,i.length,o.length,JSON.stringify(o),"analyzing").run()).meta.last_row_id;for(let h=0;h<i.length;h++)await e.env.DB.prepare(`
        INSERT INTO data_rows (dataset_id, row_number, data, is_cleaned)
        VALUES (?, ?, ?, ?)
      `).bind(d,h,JSON.stringify(i[h]),0).run();if(i.length<=100)try{await Rt(d,i,o,e.env.DB);const f=(await e.env.DB.prepare(`
          SELECT * FROM analyses WHERE dataset_id = ?
        `).bind(d).all()).results.map(x=>({...x,result:JSON.parse(x.result)}));await St(d,i,f,e.env.DB),await e.env.DB.prepare(`
          UPDATE datasets SET analysis_status = ?, cleaning_status = ?, visualization_status = ?
          WHERE id = ?
        `).bind("complete","complete","complete",d).run()}catch(h){console.error("Analysis error:",h),await e.env.DB.prepare(`
          UPDATE datasets SET analysis_status = ?
          WHERE id = ?
        `).bind("error",d).run()}return e.json({success:!0,dataset_id:d,message:"Upload successful. Analysis started.",row_count:i.length,column_count:o.length,columns:o})}catch(t){return console.error("Upload error:",t),e.json({error:"Upload failed: "+t.message},500)}});const de=new Se;de.get("/",async e=>{try{const r=(await e.env.DB.prepare(`
      SELECT * FROM datasets ORDER BY upload_date DESC
    `).all()).results.map(n=>({...n,columns:JSON.parse(n.columns)}));return e.json({datasets:r})}catch{return e.json({error:"Failed to fetch datasets"},500)}});de.get("/:id",async e=>{try{const t=e.req.param("id"),r=await e.env.DB.prepare(`
      SELECT * FROM datasets WHERE id = ?
    `).bind(t).first();if(!r)return e.json({error:"Dataset not found"},404);const a=(await e.env.DB.prepare(`
      SELECT data FROM data_rows WHERE dataset_id = ? AND is_cleaned = 0 LIMIT 10
    `).bind(t).all()).results.map(s=>JSON.parse(s.data));return e.json({dataset:{...r,columns:JSON.parse(r.columns)},sample:a})}catch{return e.json({error:"Failed to fetch dataset"},500)}});de.get("/:id/analyses",async e=>{try{const t=e.req.param("id"),n=(await e.env.DB.prepare(`
      SELECT * FROM analyses WHERE dataset_id = ? ORDER BY importance DESC, confidence DESC
    `).bind(t).all()).results.map(a=>({...a,result:JSON.parse(a.result)}));return e.json({analyses:n})}catch{return e.json({error:"Failed to fetch analyses"},500)}});de.get("/:id/visualizations",async e=>{try{const t=e.req.param("id"),n=(await e.env.DB.prepare(`
      SELECT * FROM visualizations WHERE dataset_id = ? ORDER BY display_order
    `).bind(t).all()).results.map(a=>({...a,config:JSON.parse(a.config)}));return e.json({visualizations:n})}catch{return e.json({error:"Failed to fetch visualizations"},500)}});de.delete("/:id",async e=>{try{const t=e.req.param("id");return await e.env.DB.prepare(`
      DELETE FROM datasets WHERE id = ?
    `).bind(t).run(),e.json({success:!0,message:"Dataset deleted"})}catch{return e.json({error:"Failed to delete dataset"},500)}});const Ct=new Se;Ct.post("/:id",async e=>{try{const t=Number(e.req.param("id")),r=await e.env.DB.prepare(`
      SELECT * FROM datasets WHERE id = ?
    `).bind(t).first();if(!r)return e.json({error:"Dataset not found"},404);const a=(await e.env.DB.prepare(`
      SELECT data FROM data_rows WHERE dataset_id = ? AND is_cleaned = 0
    `).bind(t).all()).results.map(o=>JSON.parse(o.data)),s=JSON.parse(r.columns);await Rt(t,a,s,e.env.DB);const l=(await e.env.DB.prepare(`
      SELECT * FROM analyses WHERE dataset_id = ?
    `).bind(t).all()).results.map(o=>({...o,result:JSON.parse(o.result)}));return await St(t,a,l,e.env.DB),await e.env.DB.prepare(`
      UPDATE datasets SET analysis_status = ?, visualization_status = ?
      WHERE id = ?
    `).bind("complete","complete",t).run(),e.json({success:!0,message:"Analysis complete",analyses_count:l.length,dataset_id:t})}catch(t){return console.error("Analysis error:",t),e.json({error:"Analysis failed: "+t.message},500)}});const J=new Se;J.use("/api/*",lr());J.use("/static/*",xr({root:"./public"}));J.route("/api/upload",Ot);J.route("/api/datasets",de);J.route("/api/analyze",Ct);J.get("/api/health",e=>e.json({status:"ok",timestamp:new Date().toISOString()}));J.get("/",e=>e.html(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Data Intelligence Platform</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"><\/script>
        <style>
          .upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s;
          }
          .upload-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
          }
          .insight-card {
            animation: slideIn 0.5s ease-out;
          }
          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateY(20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          .importance-high { border-left: 4px solid #ef4444; }
          .importance-medium { border-left: 4px solid #f59e0b; }
          .importance-low { border-left: 4px solid #10b981; }
        </style>
    </head>
    <body class="bg-gray-50">
        <div class="min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b">
                <div class="max-w-7xl mx-auto px-4 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">
                                <i class="fas fa-brain text-blue-600 mr-3"></i>
                                Data Intelligence Platform
                            </h1>
                            <p class="text-gray-600 mt-1">Upload → Analyze → Understand. Automated insights from your data.</p>
                        </div>
                        <button id="view-datasets" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                            <i class="fas fa-database mr-2"></i>My Datasets
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 py-8">
                <!-- Upload Section -->
                <div id="upload-section" class="mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-upload mr-2 text-blue-600"></i>
                            Upload Your Data
                        </h2>
                        <p class="text-gray-600 mb-6">
                            Drop a CSV or JSON file below and we'll automatically analyze it, find patterns, 
                            and explain what matters in plain English.
                        </p>

                        <div id="upload-area" class="upload-area rounded-lg p-12 text-center cursor-pointer">
                            <input type="file" id="file-input" accept=".csv,.json" class="hidden">
                            <div id="upload-prompt">
                                <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                                <p class="text-xl text-gray-700 mb-2">Drop your file here or click to browse</p>
                                <p class="text-sm text-gray-500">Supports CSV and JSON files</p>
                            </div>
                            <div id="upload-progress" class="hidden">
                                <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                                <p class="text-lg text-gray-700">Uploading and analyzing...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="results-section" class="hidden">
                    <!-- Dataset Info -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                            Dataset Overview
                        </h2>
                        <div id="dataset-info" class="grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                    </div>

                    <!-- Visualizations -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-line mr-2 text-purple-600"></i>
                            Visual Insights
                        </h2>
                        <div id="visualizations-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    </div>

                    <!-- Key Insights -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                            Key Insights
                        </h2>
                        <div id="insights-container" class="space-y-4"></div>
                    </div>

                    <!-- Sample Data -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-table mr-2 text-green-600"></i>
                            Sample Data
                        </h2>
                        <div id="sample-data" class="overflow-x-auto"></div>
                    </div>
                </div>

                <!-- Datasets List -->
                <div id="datasets-section" class="hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-database mr-2 text-blue-600"></i>
                                Your Datasets
                            </h2>
                            <button id="back-to-upload" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-plus mr-2"></i>New Upload
                            </button>
                        </div>
                        <div id="datasets-list"></div>
                    </div>
                </div>
            </main>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
        <script src="/static/app.js"><\/script>
    </body>
    </html>
  `));const Ye=new Se,Fr=Object.assign({"/src/index.tsx":J});let Nt=!1;for(const[,e]of Object.entries(Fr))e&&(Ye.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Ye.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Nt=!0);if(!Nt)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Ye as default};
